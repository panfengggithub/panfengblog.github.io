<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>谷粒商城—高可用集群 | 编程印象</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="我盼世界无 bug">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.6ae13786.css" as="style"><link rel="preload" href="/assets/js/app.3253cff9.js" as="script"><link rel="preload" href="/assets/js/3.fb47a76d.js" as="script"><link rel="preload" href="/assets/js/1.fc79f8d4.js" as="script"><link rel="preload" href="/assets/js/526.355d784d.js" as="script"><link rel="prefetch" href="/assets/js/10.23520678.js"><link rel="prefetch" href="/assets/js/100.93718c39.js"><link rel="prefetch" href="/assets/js/101.8807c827.js"><link rel="prefetch" href="/assets/js/102.f4eb89c1.js"><link rel="prefetch" href="/assets/js/103.d18aafb5.js"><link rel="prefetch" href="/assets/js/104.43d0cc11.js"><link rel="prefetch" href="/assets/js/105.67340c3b.js"><link rel="prefetch" href="/assets/js/106.abed7aa5.js"><link rel="prefetch" href="/assets/js/107.76a76d46.js"><link rel="prefetch" href="/assets/js/108.f975bf5c.js"><link rel="prefetch" href="/assets/js/109.96a37aab.js"><link rel="prefetch" href="/assets/js/11.9023628e.js"><link rel="prefetch" href="/assets/js/110.06187ca1.js"><link rel="prefetch" href="/assets/js/111.fbdaa44e.js"><link rel="prefetch" href="/assets/js/112.983dfab9.js"><link rel="prefetch" href="/assets/js/113.62b0732c.js"><link rel="prefetch" href="/assets/js/114.c0e3a01c.js"><link rel="prefetch" href="/assets/js/115.68fbac47.js"><link rel="prefetch" href="/assets/js/116.0f119443.js"><link rel="prefetch" href="/assets/js/117.b3a09375.js"><link rel="prefetch" href="/assets/js/118.a76ac7b8.js"><link rel="prefetch" href="/assets/js/119.cdc21714.js"><link rel="prefetch" href="/assets/js/12.a13068e6.js"><link rel="prefetch" href="/assets/js/120.cf4e0dbf.js"><link rel="prefetch" href="/assets/js/121.4572e77e.js"><link rel="prefetch" href="/assets/js/122.e172753e.js"><link rel="prefetch" href="/assets/js/123.4ed93b9e.js"><link rel="prefetch" href="/assets/js/124.c765ccc5.js"><link rel="prefetch" href="/assets/js/125.c392a2a9.js"><link rel="prefetch" href="/assets/js/126.f8704f93.js"><link rel="prefetch" href="/assets/js/127.07c9ee28.js"><link rel="prefetch" href="/assets/js/128.dc36ecdf.js"><link rel="prefetch" href="/assets/js/129.48f156bd.js"><link rel="prefetch" href="/assets/js/13.cbc4607a.js"><link rel="prefetch" href="/assets/js/130.d84df005.js"><link rel="prefetch" href="/assets/js/131.0fed3443.js"><link rel="prefetch" href="/assets/js/132.ac342f04.js"><link rel="prefetch" href="/assets/js/133.2913b600.js"><link rel="prefetch" href="/assets/js/134.33a37a87.js"><link rel="prefetch" href="/assets/js/135.c2edf334.js"><link rel="prefetch" href="/assets/js/136.9d14fac2.js"><link rel="prefetch" href="/assets/js/137.34356783.js"><link rel="prefetch" href="/assets/js/138.f308ad19.js"><link rel="prefetch" href="/assets/js/139.564b2788.js"><link rel="prefetch" href="/assets/js/14.d5d8fb95.js"><link rel="prefetch" href="/assets/js/140.b7ba5dd1.js"><link rel="prefetch" href="/assets/js/141.0ab1a516.js"><link rel="prefetch" href="/assets/js/142.130f79d6.js"><link rel="prefetch" href="/assets/js/143.47298375.js"><link rel="prefetch" href="/assets/js/144.6299ffd6.js"><link rel="prefetch" href="/assets/js/145.be35092a.js"><link rel="prefetch" href="/assets/js/146.a09759ec.js"><link rel="prefetch" href="/assets/js/147.cf69e6a9.js"><link rel="prefetch" href="/assets/js/148.7e0ef2c7.js"><link rel="prefetch" href="/assets/js/149.1962445f.js"><link rel="prefetch" href="/assets/js/15.f41f1f80.js"><link rel="prefetch" href="/assets/js/150.ef273823.js"><link rel="prefetch" href="/assets/js/151.d8a4d3d5.js"><link rel="prefetch" href="/assets/js/152.dc1f23c0.js"><link rel="prefetch" href="/assets/js/153.a48e85cd.js"><link rel="prefetch" href="/assets/js/154.c2cec62b.js"><link rel="prefetch" href="/assets/js/155.a11ad3a7.js"><link rel="prefetch" href="/assets/js/156.6c04aef7.js"><link rel="prefetch" href="/assets/js/157.5deb9ca3.js"><link rel="prefetch" href="/assets/js/158.3181b0cc.js"><link rel="prefetch" href="/assets/js/159.d693ec37.js"><link rel="prefetch" href="/assets/js/16.840b9a23.js"><link rel="prefetch" href="/assets/js/160.75e46d4c.js"><link rel="prefetch" href="/assets/js/161.c518f803.js"><link rel="prefetch" href="/assets/js/162.ac57cb54.js"><link rel="prefetch" href="/assets/js/163.6e1a1b17.js"><link rel="prefetch" href="/assets/js/164.246c8ea5.js"><link rel="prefetch" href="/assets/js/165.2992ed51.js"><link rel="prefetch" href="/assets/js/166.192080dc.js"><link rel="prefetch" href="/assets/js/167.1097b2cb.js"><link rel="prefetch" href="/assets/js/168.d56da423.js"><link rel="prefetch" href="/assets/js/169.e4adc884.js"><link rel="prefetch" href="/assets/js/17.3257631f.js"><link rel="prefetch" href="/assets/js/170.0e25a232.js"><link rel="prefetch" href="/assets/js/171.722b90bf.js"><link rel="prefetch" href="/assets/js/172.8dba1018.js"><link rel="prefetch" href="/assets/js/173.43ab2aab.js"><link rel="prefetch" href="/assets/js/174.479647b1.js"><link rel="prefetch" href="/assets/js/175.923a2b19.js"><link rel="prefetch" href="/assets/js/176.69868846.js"><link rel="prefetch" href="/assets/js/177.7ce7756d.js"><link rel="prefetch" href="/assets/js/178.e4023160.js"><link rel="prefetch" href="/assets/js/179.0fa8c7a2.js"><link rel="prefetch" href="/assets/js/18.9a722c1d.js"><link rel="prefetch" href="/assets/js/180.a4b40c61.js"><link rel="prefetch" href="/assets/js/181.7e5257a0.js"><link rel="prefetch" href="/assets/js/182.908ec19a.js"><link rel="prefetch" href="/assets/js/183.c58419b8.js"><link rel="prefetch" href="/assets/js/184.44d09521.js"><link rel="prefetch" href="/assets/js/185.bdd1583f.js"><link rel="prefetch" href="/assets/js/186.2f31cbe2.js"><link rel="prefetch" href="/assets/js/187.1fad68bf.js"><link rel="prefetch" href="/assets/js/188.c1825332.js"><link rel="prefetch" href="/assets/js/189.3d383d29.js"><link rel="prefetch" href="/assets/js/19.de53f6be.js"><link rel="prefetch" href="/assets/js/190.459e8de3.js"><link rel="prefetch" href="/assets/js/191.947734e0.js"><link rel="prefetch" href="/assets/js/192.c27e106b.js"><link rel="prefetch" href="/assets/js/193.096dc95c.js"><link rel="prefetch" href="/assets/js/194.d5f581af.js"><link rel="prefetch" href="/assets/js/195.22b7ddbe.js"><link rel="prefetch" href="/assets/js/196.4cb41b31.js"><link rel="prefetch" href="/assets/js/197.d67d40fc.js"><link rel="prefetch" href="/assets/js/198.5424cd3e.js"><link rel="prefetch" href="/assets/js/199.0aa621a1.js"><link rel="prefetch" href="/assets/js/20.189dd3a4.js"><link rel="prefetch" href="/assets/js/200.e7b7d35f.js"><link rel="prefetch" href="/assets/js/201.03199748.js"><link rel="prefetch" href="/assets/js/202.81e42119.js"><link rel="prefetch" href="/assets/js/203.6a2e682d.js"><link rel="prefetch" href="/assets/js/204.b0fe8107.js"><link rel="prefetch" href="/assets/js/205.1d3dec50.js"><link rel="prefetch" href="/assets/js/206.17f9cfd2.js"><link rel="prefetch" href="/assets/js/207.6615566b.js"><link rel="prefetch" href="/assets/js/208.69fa33bf.js"><link rel="prefetch" href="/assets/js/209.7fdd3440.js"><link rel="prefetch" href="/assets/js/21.0ecc69c1.js"><link rel="prefetch" href="/assets/js/210.1b579f1b.js"><link rel="prefetch" href="/assets/js/211.74af228b.js"><link rel="prefetch" href="/assets/js/212.91058a98.js"><link rel="prefetch" href="/assets/js/213.cc8d57b4.js"><link rel="prefetch" href="/assets/js/214.6f19c8ca.js"><link rel="prefetch" href="/assets/js/215.7d4f7c64.js"><link rel="prefetch" href="/assets/js/216.affcb992.js"><link rel="prefetch" href="/assets/js/217.a56f5bf9.js"><link rel="prefetch" href="/assets/js/218.bfab0aae.js"><link rel="prefetch" href="/assets/js/219.3b7167b0.js"><link rel="prefetch" href="/assets/js/22.e9e66869.js"><link rel="prefetch" href="/assets/js/220.16478f2c.js"><link rel="prefetch" href="/assets/js/221.0ed5e8bc.js"><link rel="prefetch" href="/assets/js/222.9a73499b.js"><link rel="prefetch" href="/assets/js/223.67530e8b.js"><link rel="prefetch" href="/assets/js/224.72adbc45.js"><link rel="prefetch" href="/assets/js/225.4bb7d320.js"><link rel="prefetch" href="/assets/js/226.8b275e87.js"><link rel="prefetch" href="/assets/js/227.04d7a9f3.js"><link rel="prefetch" href="/assets/js/228.ce8e7a21.js"><link rel="prefetch" href="/assets/js/229.781599c8.js"><link rel="prefetch" href="/assets/js/23.acbaf714.js"><link rel="prefetch" href="/assets/js/230.52a0e6a9.js"><link rel="prefetch" href="/assets/js/231.46dafccb.js"><link rel="prefetch" href="/assets/js/232.d3d999a6.js"><link rel="prefetch" href="/assets/js/233.b5bcf27d.js"><link rel="prefetch" href="/assets/js/234.8f1dc6b5.js"><link rel="prefetch" href="/assets/js/235.db41b05f.js"><link rel="prefetch" href="/assets/js/236.678648c0.js"><link rel="prefetch" href="/assets/js/237.f2f59a89.js"><link rel="prefetch" href="/assets/js/238.3943d80e.js"><link rel="prefetch" href="/assets/js/239.80653d5a.js"><link rel="prefetch" href="/assets/js/24.2b90a12c.js"><link rel="prefetch" href="/assets/js/240.4ddf5f68.js"><link rel="prefetch" href="/assets/js/241.6b9554b3.js"><link rel="prefetch" href="/assets/js/242.a9ab5b7e.js"><link rel="prefetch" href="/assets/js/243.282f07df.js"><link rel="prefetch" href="/assets/js/244.b9004515.js"><link rel="prefetch" href="/assets/js/245.8cc1a50d.js"><link rel="prefetch" href="/assets/js/246.6ad47e79.js"><link rel="prefetch" href="/assets/js/247.70b03249.js"><link rel="prefetch" href="/assets/js/248.02bcbdd3.js"><link rel="prefetch" href="/assets/js/249.4e6b4466.js"><link rel="prefetch" href="/assets/js/25.6624fb44.js"><link rel="prefetch" href="/assets/js/250.bb4f82a1.js"><link rel="prefetch" href="/assets/js/251.eff9ea79.js"><link rel="prefetch" href="/assets/js/252.258996db.js"><link rel="prefetch" href="/assets/js/253.1c951050.js"><link rel="prefetch" href="/assets/js/254.f7e7c08d.js"><link rel="prefetch" href="/assets/js/255.d9f57fad.js"><link rel="prefetch" href="/assets/js/256.3311e1f0.js"><link rel="prefetch" href="/assets/js/257.eea61447.js"><link rel="prefetch" href="/assets/js/258.55cd542c.js"><link rel="prefetch" href="/assets/js/259.74bee638.js"><link rel="prefetch" href="/assets/js/26.e1ca8941.js"><link rel="prefetch" href="/assets/js/260.4267bc70.js"><link rel="prefetch" href="/assets/js/261.85a4a515.js"><link rel="prefetch" href="/assets/js/262.03ec6fb7.js"><link rel="prefetch" href="/assets/js/263.f3f38680.js"><link rel="prefetch" href="/assets/js/264.2716a133.js"><link rel="prefetch" href="/assets/js/265.7915e3d3.js"><link rel="prefetch" href="/assets/js/266.65b73149.js"><link rel="prefetch" href="/assets/js/267.1facbdc4.js"><link rel="prefetch" href="/assets/js/268.08143e7e.js"><link rel="prefetch" href="/assets/js/269.a86db7d4.js"><link rel="prefetch" href="/assets/js/27.4b8aa781.js"><link rel="prefetch" href="/assets/js/270.48e4c99a.js"><link rel="prefetch" href="/assets/js/271.5f32be86.js"><link rel="prefetch" href="/assets/js/272.bb1e4313.js"><link rel="prefetch" href="/assets/js/273.7a248e90.js"><link rel="prefetch" href="/assets/js/274.9c1c38d0.js"><link rel="prefetch" href="/assets/js/275.4f6b78c1.js"><link rel="prefetch" href="/assets/js/276.b0a9df97.js"><link rel="prefetch" href="/assets/js/277.979222be.js"><link rel="prefetch" href="/assets/js/278.e2228968.js"><link rel="prefetch" href="/assets/js/279.ceaddf6d.js"><link rel="prefetch" href="/assets/js/28.9a7edf7c.js"><link rel="prefetch" href="/assets/js/280.90b51cbd.js"><link rel="prefetch" href="/assets/js/281.053a17f6.js"><link rel="prefetch" href="/assets/js/282.e4e80ea7.js"><link rel="prefetch" href="/assets/js/283.92fad18e.js"><link rel="prefetch" href="/assets/js/284.ebf38fbd.js"><link rel="prefetch" href="/assets/js/285.f45a4dda.js"><link rel="prefetch" href="/assets/js/286.81f38fe4.js"><link rel="prefetch" href="/assets/js/287.3e06538e.js"><link rel="prefetch" href="/assets/js/288.ecaa3096.js"><link rel="prefetch" href="/assets/js/289.0fe759d5.js"><link rel="prefetch" href="/assets/js/29.2fd518a3.js"><link rel="prefetch" href="/assets/js/290.ab59483e.js"><link rel="prefetch" href="/assets/js/291.41a30ef1.js"><link rel="prefetch" href="/assets/js/292.8c1608b4.js"><link rel="prefetch" href="/assets/js/293.0344eb5e.js"><link rel="prefetch" href="/assets/js/294.fd83d36f.js"><link rel="prefetch" href="/assets/js/295.8938c5a7.js"><link rel="prefetch" href="/assets/js/296.469f3c60.js"><link rel="prefetch" href="/assets/js/297.3a066b09.js"><link rel="prefetch" href="/assets/js/298.a242be9a.js"><link rel="prefetch" href="/assets/js/299.8b789510.js"><link rel="prefetch" href="/assets/js/30.179efd2b.js"><link rel="prefetch" href="/assets/js/300.0f4a9886.js"><link rel="prefetch" href="/assets/js/301.1b2be4ce.js"><link rel="prefetch" href="/assets/js/302.341fa23c.js"><link rel="prefetch" href="/assets/js/303.34c65023.js"><link rel="prefetch" href="/assets/js/304.13552a1f.js"><link rel="prefetch" href="/assets/js/305.cf62e8fb.js"><link rel="prefetch" href="/assets/js/306.6cc34c03.js"><link rel="prefetch" href="/assets/js/307.34da57b9.js"><link rel="prefetch" href="/assets/js/308.873049ea.js"><link rel="prefetch" href="/assets/js/309.e3f3cbc2.js"><link rel="prefetch" href="/assets/js/31.d11bc639.js"><link rel="prefetch" href="/assets/js/310.ad2f1760.js"><link rel="prefetch" href="/assets/js/311.9f9e384d.js"><link rel="prefetch" href="/assets/js/312.36ee6d77.js"><link rel="prefetch" href="/assets/js/313.ce5b3d4d.js"><link rel="prefetch" href="/assets/js/314.c20bcf8e.js"><link rel="prefetch" href="/assets/js/315.674a18bc.js"><link rel="prefetch" href="/assets/js/316.b45ffc77.js"><link rel="prefetch" href="/assets/js/317.2024a5e3.js"><link rel="prefetch" href="/assets/js/318.3bf40aad.js"><link rel="prefetch" href="/assets/js/319.9bd66a93.js"><link rel="prefetch" href="/assets/js/32.411ceef9.js"><link rel="prefetch" href="/assets/js/320.3783f0bf.js"><link rel="prefetch" href="/assets/js/321.eb018e84.js"><link rel="prefetch" href="/assets/js/322.be14d2fd.js"><link rel="prefetch" href="/assets/js/323.1ceabf09.js"><link rel="prefetch" href="/assets/js/324.ed23b35b.js"><link rel="prefetch" href="/assets/js/325.b0ccb438.js"><link rel="prefetch" href="/assets/js/326.69d1c953.js"><link rel="prefetch" href="/assets/js/327.344a9a90.js"><link rel="prefetch" href="/assets/js/328.49306968.js"><link rel="prefetch" href="/assets/js/329.233b2907.js"><link rel="prefetch" href="/assets/js/33.934564aa.js"><link rel="prefetch" href="/assets/js/330.24d28c45.js"><link rel="prefetch" href="/assets/js/331.97515483.js"><link rel="prefetch" href="/assets/js/332.85b51742.js"><link rel="prefetch" href="/assets/js/333.906a8068.js"><link rel="prefetch" href="/assets/js/334.f7ad52e1.js"><link rel="prefetch" href="/assets/js/335.6cc0bd77.js"><link rel="prefetch" href="/assets/js/336.87877231.js"><link rel="prefetch" href="/assets/js/337.8144d700.js"><link rel="prefetch" href="/assets/js/338.95b240e5.js"><link rel="prefetch" href="/assets/js/339.8bef0948.js"><link rel="prefetch" href="/assets/js/34.d2453238.js"><link rel="prefetch" href="/assets/js/340.148b26e4.js"><link rel="prefetch" href="/assets/js/341.9a6e7d83.js"><link rel="prefetch" href="/assets/js/342.ee2587db.js"><link rel="prefetch" href="/assets/js/343.54316969.js"><link rel="prefetch" href="/assets/js/344.60bcf181.js"><link rel="prefetch" href="/assets/js/345.9f1005de.js"><link rel="prefetch" href="/assets/js/346.f8fa6ecf.js"><link rel="prefetch" href="/assets/js/347.beabeac7.js"><link rel="prefetch" href="/assets/js/348.c2d6bf3b.js"><link rel="prefetch" href="/assets/js/349.b92bd54d.js"><link rel="prefetch" href="/assets/js/35.c00cf496.js"><link rel="prefetch" href="/assets/js/350.9f88cdec.js"><link rel="prefetch" href="/assets/js/351.8414f1f4.js"><link rel="prefetch" href="/assets/js/352.cc964ebc.js"><link rel="prefetch" href="/assets/js/353.554d22da.js"><link rel="prefetch" href="/assets/js/354.7eaf625e.js"><link rel="prefetch" href="/assets/js/355.f11d2e1e.js"><link rel="prefetch" href="/assets/js/356.c906cb47.js"><link rel="prefetch" href="/assets/js/357.9f7e872a.js"><link rel="prefetch" href="/assets/js/358.a305265d.js"><link rel="prefetch" href="/assets/js/359.8dbe283e.js"><link rel="prefetch" href="/assets/js/36.faba35a7.js"><link rel="prefetch" href="/assets/js/360.531d1e7c.js"><link rel="prefetch" href="/assets/js/361.a2907b58.js"><link rel="prefetch" href="/assets/js/362.8210d676.js"><link rel="prefetch" href="/assets/js/363.a9784d82.js"><link rel="prefetch" href="/assets/js/364.b2de68fd.js"><link rel="prefetch" href="/assets/js/365.f1269656.js"><link rel="prefetch" href="/assets/js/366.4b072edc.js"><link rel="prefetch" href="/assets/js/367.7bf486d7.js"><link rel="prefetch" href="/assets/js/368.8c0b986a.js"><link rel="prefetch" href="/assets/js/369.cbf1cd46.js"><link rel="prefetch" href="/assets/js/37.654e7ec8.js"><link rel="prefetch" href="/assets/js/370.b984d834.js"><link rel="prefetch" href="/assets/js/371.a0e9536d.js"><link rel="prefetch" href="/assets/js/372.cc449953.js"><link rel="prefetch" href="/assets/js/373.968357b7.js"><link rel="prefetch" href="/assets/js/374.94cc8c1b.js"><link rel="prefetch" href="/assets/js/375.bc38db72.js"><link rel="prefetch" href="/assets/js/376.26c7f4b7.js"><link rel="prefetch" href="/assets/js/377.116f8f31.js"><link rel="prefetch" href="/assets/js/378.ea4739e2.js"><link rel="prefetch" href="/assets/js/379.34e0290e.js"><link rel="prefetch" href="/assets/js/38.16fd258d.js"><link rel="prefetch" href="/assets/js/380.3176f37c.js"><link rel="prefetch" href="/assets/js/381.469c3715.js"><link rel="prefetch" href="/assets/js/382.6f6a1603.js"><link rel="prefetch" href="/assets/js/383.f21ca31b.js"><link rel="prefetch" href="/assets/js/384.f8b39f7f.js"><link rel="prefetch" href="/assets/js/385.14828af3.js"><link rel="prefetch" href="/assets/js/386.cc1a1ba7.js"><link rel="prefetch" href="/assets/js/387.110e418d.js"><link rel="prefetch" href="/assets/js/388.8fe6b21a.js"><link rel="prefetch" href="/assets/js/389.35e2ed38.js"><link rel="prefetch" href="/assets/js/39.6969f4f3.js"><link rel="prefetch" href="/assets/js/390.89fa39b5.js"><link rel="prefetch" href="/assets/js/391.3827fd0b.js"><link rel="prefetch" href="/assets/js/392.13902464.js"><link rel="prefetch" href="/assets/js/393.9a034697.js"><link rel="prefetch" href="/assets/js/394.3b0e1f60.js"><link rel="prefetch" href="/assets/js/395.6a16a573.js"><link rel="prefetch" href="/assets/js/396.3e7da957.js"><link rel="prefetch" href="/assets/js/397.7123e053.js"><link rel="prefetch" href="/assets/js/398.262c76b5.js"><link rel="prefetch" href="/assets/js/399.de8cdb94.js"><link rel="prefetch" href="/assets/js/4.35359649.js"><link rel="prefetch" href="/assets/js/40.1b08e3c1.js"><link rel="prefetch" href="/assets/js/400.f280e50a.js"><link rel="prefetch" href="/assets/js/401.085e9e4e.js"><link rel="prefetch" href="/assets/js/402.c788e695.js"><link rel="prefetch" href="/assets/js/403.3a2e4f4e.js"><link rel="prefetch" href="/assets/js/404.0483ba04.js"><link rel="prefetch" href="/assets/js/405.bceeeae8.js"><link rel="prefetch" href="/assets/js/406.1435053a.js"><link rel="prefetch" href="/assets/js/407.f2737d22.js"><link rel="prefetch" href="/assets/js/408.2e5f3b47.js"><link rel="prefetch" href="/assets/js/409.cff1f097.js"><link rel="prefetch" href="/assets/js/41.1a123cc0.js"><link rel="prefetch" href="/assets/js/410.88235822.js"><link rel="prefetch" href="/assets/js/411.3a928742.js"><link rel="prefetch" href="/assets/js/412.169a4d49.js"><link rel="prefetch" href="/assets/js/413.58cdba30.js"><link rel="prefetch" href="/assets/js/414.3fbe49c9.js"><link rel="prefetch" href="/assets/js/415.c10f98b8.js"><link rel="prefetch" href="/assets/js/416.656d84fb.js"><link rel="prefetch" href="/assets/js/417.1eb6a1b5.js"><link rel="prefetch" href="/assets/js/418.4725206d.js"><link rel="prefetch" href="/assets/js/419.a4e8be27.js"><link rel="prefetch" href="/assets/js/42.c2920855.js"><link rel="prefetch" href="/assets/js/420.6e01408a.js"><link rel="prefetch" href="/assets/js/421.02adc195.js"><link rel="prefetch" href="/assets/js/422.548dac13.js"><link rel="prefetch" href="/assets/js/423.09a6db28.js"><link rel="prefetch" href="/assets/js/424.eb500fa2.js"><link rel="prefetch" href="/assets/js/425.bce01a3c.js"><link rel="prefetch" href="/assets/js/426.7d173b45.js"><link rel="prefetch" href="/assets/js/427.c01c5d28.js"><link rel="prefetch" href="/assets/js/428.f15290b5.js"><link rel="prefetch" href="/assets/js/429.62076006.js"><link rel="prefetch" href="/assets/js/43.2d4923ce.js"><link rel="prefetch" href="/assets/js/430.3fa5093c.js"><link rel="prefetch" href="/assets/js/431.a224c2db.js"><link rel="prefetch" href="/assets/js/432.539a55ea.js"><link rel="prefetch" href="/assets/js/433.4b5a10de.js"><link rel="prefetch" href="/assets/js/434.eedd34cc.js"><link rel="prefetch" href="/assets/js/435.9fcfbdc7.js"><link rel="prefetch" href="/assets/js/436.940a0046.js"><link rel="prefetch" href="/assets/js/437.7c84d28b.js"><link rel="prefetch" href="/assets/js/438.202eca6d.js"><link rel="prefetch" href="/assets/js/439.f0d941e6.js"><link rel="prefetch" href="/assets/js/44.705bdccd.js"><link rel="prefetch" href="/assets/js/440.f47aec21.js"><link rel="prefetch" href="/assets/js/441.867ce0ab.js"><link rel="prefetch" href="/assets/js/442.0f65a544.js"><link rel="prefetch" href="/assets/js/443.1e5097b4.js"><link rel="prefetch" href="/assets/js/444.f3eb9953.js"><link rel="prefetch" href="/assets/js/445.11611d78.js"><link rel="prefetch" href="/assets/js/446.3d757c04.js"><link rel="prefetch" href="/assets/js/447.c11e8802.js"><link rel="prefetch" href="/assets/js/448.a5e6c622.js"><link rel="prefetch" href="/assets/js/449.fa264139.js"><link rel="prefetch" href="/assets/js/45.e93b9e62.js"><link rel="prefetch" href="/assets/js/450.d3468ceb.js"><link rel="prefetch" href="/assets/js/451.1de06ec3.js"><link rel="prefetch" href="/assets/js/452.e46f40ff.js"><link rel="prefetch" href="/assets/js/453.79870d60.js"><link rel="prefetch" href="/assets/js/454.cc4d5db1.js"><link rel="prefetch" href="/assets/js/455.7f759fce.js"><link rel="prefetch" href="/assets/js/456.58224467.js"><link rel="prefetch" href="/assets/js/457.f6147247.js"><link rel="prefetch" href="/assets/js/458.8926e6db.js"><link rel="prefetch" href="/assets/js/459.4e9f82d9.js"><link rel="prefetch" href="/assets/js/46.531dead0.js"><link rel="prefetch" href="/assets/js/460.db9151a7.js"><link rel="prefetch" href="/assets/js/461.a271152e.js"><link rel="prefetch" href="/assets/js/462.bc18c78a.js"><link rel="prefetch" href="/assets/js/463.2ead1412.js"><link rel="prefetch" href="/assets/js/464.687f59b0.js"><link rel="prefetch" href="/assets/js/465.cb838a77.js"><link rel="prefetch" href="/assets/js/466.6bfc4ce5.js"><link rel="prefetch" href="/assets/js/467.222f7de4.js"><link rel="prefetch" href="/assets/js/468.6d0976ab.js"><link rel="prefetch" href="/assets/js/469.e30cbb6c.js"><link rel="prefetch" href="/assets/js/47.762ca375.js"><link rel="prefetch" href="/assets/js/470.25942500.js"><link rel="prefetch" href="/assets/js/471.ad57d68f.js"><link rel="prefetch" href="/assets/js/472.191a2962.js"><link rel="prefetch" href="/assets/js/473.b04c9f53.js"><link rel="prefetch" href="/assets/js/474.0db1cf4b.js"><link rel="prefetch" href="/assets/js/475.7c7e1f90.js"><link rel="prefetch" href="/assets/js/476.c275fdc4.js"><link rel="prefetch" href="/assets/js/477.feb2923b.js"><link rel="prefetch" href="/assets/js/478.f7793677.js"><link rel="prefetch" href="/assets/js/479.119ef0bc.js"><link rel="prefetch" href="/assets/js/48.084624de.js"><link rel="prefetch" href="/assets/js/480.2abe0496.js"><link rel="prefetch" href="/assets/js/481.3dd0fb2f.js"><link rel="prefetch" href="/assets/js/482.1941c332.js"><link rel="prefetch" href="/assets/js/483.40e9043c.js"><link rel="prefetch" href="/assets/js/484.466d997f.js"><link rel="prefetch" href="/assets/js/485.8cb07e25.js"><link rel="prefetch" href="/assets/js/486.3b50e3f5.js"><link rel="prefetch" href="/assets/js/487.d638988d.js"><link rel="prefetch" href="/assets/js/488.675d91bf.js"><link rel="prefetch" href="/assets/js/489.25e6ae59.js"><link rel="prefetch" href="/assets/js/49.daf396b2.js"><link rel="prefetch" href="/assets/js/490.823a35a8.js"><link rel="prefetch" href="/assets/js/491.6e7e0102.js"><link rel="prefetch" href="/assets/js/492.ea8cf4c8.js"><link rel="prefetch" href="/assets/js/493.dbcb0062.js"><link rel="prefetch" href="/assets/js/494.b3081e33.js"><link rel="prefetch" href="/assets/js/495.39902e9e.js"><link rel="prefetch" href="/assets/js/496.72be674c.js"><link rel="prefetch" href="/assets/js/497.7c1adaaf.js"><link rel="prefetch" href="/assets/js/498.51ca2bcf.js"><link rel="prefetch" href="/assets/js/499.16ec3f37.js"><link rel="prefetch" href="/assets/js/5.6361159c.js"><link rel="prefetch" href="/assets/js/50.15811d48.js"><link rel="prefetch" href="/assets/js/500.b44f720f.js"><link rel="prefetch" href="/assets/js/501.70f78fc9.js"><link rel="prefetch" href="/assets/js/502.553e6a02.js"><link rel="prefetch" href="/assets/js/503.af062838.js"><link rel="prefetch" href="/assets/js/504.ad917161.js"><link rel="prefetch" href="/assets/js/505.fe9d005f.js"><link rel="prefetch" href="/assets/js/506.4c555174.js"><link rel="prefetch" href="/assets/js/507.1b4cfe79.js"><link rel="prefetch" href="/assets/js/508.6fe5d86c.js"><link rel="prefetch" href="/assets/js/509.1b6f1838.js"><link rel="prefetch" href="/assets/js/51.959b9a17.js"><link rel="prefetch" href="/assets/js/510.964efd0f.js"><link rel="prefetch" href="/assets/js/511.1e4d6e94.js"><link rel="prefetch" href="/assets/js/512.17f0df98.js"><link rel="prefetch" href="/assets/js/513.8b9a3733.js"><link rel="prefetch" href="/assets/js/514.9a338868.js"><link rel="prefetch" href="/assets/js/515.3fbf966e.js"><link rel="prefetch" href="/assets/js/516.62ab1c2a.js"><link rel="prefetch" href="/assets/js/517.74d652a9.js"><link rel="prefetch" href="/assets/js/518.79adbe1e.js"><link rel="prefetch" href="/assets/js/519.d2c04358.js"><link rel="prefetch" href="/assets/js/52.cf8bf400.js"><link rel="prefetch" href="/assets/js/520.2b9e4a4b.js"><link rel="prefetch" href="/assets/js/521.c1d866a6.js"><link rel="prefetch" href="/assets/js/522.65bbede3.js"><link rel="prefetch" href="/assets/js/523.0b522df7.js"><link rel="prefetch" href="/assets/js/524.4230d581.js"><link rel="prefetch" href="/assets/js/525.ac0bd25a.js"><link rel="prefetch" href="/assets/js/527.09a94f12.js"><link rel="prefetch" href="/assets/js/528.b3791dd8.js"><link rel="prefetch" href="/assets/js/529.7ce195e0.js"><link rel="prefetch" href="/assets/js/53.0921053e.js"><link rel="prefetch" href="/assets/js/530.f2cdaa6d.js"><link rel="prefetch" href="/assets/js/531.c058c459.js"><link rel="prefetch" href="/assets/js/532.2da3ef44.js"><link rel="prefetch" href="/assets/js/533.703fc67f.js"><link rel="prefetch" href="/assets/js/534.bad86971.js"><link rel="prefetch" href="/assets/js/535.c6a7d52b.js"><link rel="prefetch" href="/assets/js/536.90ca0f8e.js"><link rel="prefetch" href="/assets/js/537.30ad8f75.js"><link rel="prefetch" href="/assets/js/538.6e74ed9b.js"><link rel="prefetch" href="/assets/js/539.cdb57c04.js"><link rel="prefetch" href="/assets/js/54.2759273e.js"><link rel="prefetch" href="/assets/js/540.a91292c7.js"><link rel="prefetch" href="/assets/js/541.990acfd0.js"><link rel="prefetch" href="/assets/js/542.bdafd6f7.js"><link rel="prefetch" href="/assets/js/543.f09fbaad.js"><link rel="prefetch" href="/assets/js/544.63e72bc4.js"><link rel="prefetch" href="/assets/js/545.35bffea9.js"><link rel="prefetch" href="/assets/js/546.7be22275.js"><link rel="prefetch" href="/assets/js/547.8ce75990.js"><link rel="prefetch" href="/assets/js/548.2567723a.js"><link rel="prefetch" href="/assets/js/55.5c4f17bb.js"><link rel="prefetch" href="/assets/js/56.284c1a39.js"><link rel="prefetch" href="/assets/js/57.4ef1f8bf.js"><link rel="prefetch" href="/assets/js/58.9e80f8b4.js"><link rel="prefetch" href="/assets/js/59.eea62b5d.js"><link rel="prefetch" href="/assets/js/6.6b20e148.js"><link rel="prefetch" href="/assets/js/60.385317f1.js"><link rel="prefetch" href="/assets/js/61.bbd0e0cd.js"><link rel="prefetch" href="/assets/js/62.6641c52a.js"><link rel="prefetch" href="/assets/js/63.8c9db8b2.js"><link rel="prefetch" href="/assets/js/64.4e03b00f.js"><link rel="prefetch" href="/assets/js/65.3f91f60e.js"><link rel="prefetch" href="/assets/js/66.7945fdad.js"><link rel="prefetch" href="/assets/js/67.38bf8f40.js"><link rel="prefetch" href="/assets/js/68.17a46d5a.js"><link rel="prefetch" href="/assets/js/69.dd738c71.js"><link rel="prefetch" href="/assets/js/7.e9deccd6.js"><link rel="prefetch" href="/assets/js/70.2d16a31f.js"><link rel="prefetch" href="/assets/js/71.c4e330f0.js"><link rel="prefetch" href="/assets/js/72.81aae29d.js"><link rel="prefetch" href="/assets/js/73.2eb4e1c6.js"><link rel="prefetch" href="/assets/js/74.d90217db.js"><link rel="prefetch" href="/assets/js/75.62b2921c.js"><link rel="prefetch" href="/assets/js/76.3574df9f.js"><link rel="prefetch" href="/assets/js/77.6fdc9f0c.js"><link rel="prefetch" href="/assets/js/78.41825b08.js"><link rel="prefetch" href="/assets/js/79.48da3c16.js"><link rel="prefetch" href="/assets/js/8.6d109cee.js"><link rel="prefetch" href="/assets/js/80.4500039f.js"><link rel="prefetch" href="/assets/js/81.97f7ce4d.js"><link rel="prefetch" href="/assets/js/82.b42c93ef.js"><link rel="prefetch" href="/assets/js/83.0a218e70.js"><link rel="prefetch" href="/assets/js/84.1f1225ba.js"><link rel="prefetch" href="/assets/js/85.5fc37de1.js"><link rel="prefetch" href="/assets/js/86.ce716788.js"><link rel="prefetch" href="/assets/js/87.2097baf9.js"><link rel="prefetch" href="/assets/js/88.a47cb316.js"><link rel="prefetch" href="/assets/js/89.b6a1c10e.js"><link rel="prefetch" href="/assets/js/9.bff31a2c.js"><link rel="prefetch" href="/assets/js/90.1f4ab682.js"><link rel="prefetch" href="/assets/js/91.5f24329c.js"><link rel="prefetch" href="/assets/js/92.40c332b8.js"><link rel="prefetch" href="/assets/js/93.7563c7a4.js"><link rel="prefetch" href="/assets/js/94.cc077d87.js"><link rel="prefetch" href="/assets/js/95.59e51d98.js"><link rel="prefetch" href="/assets/js/96.25c97b80.js"><link rel="prefetch" href="/assets/js/97.fb49f803.js"><link rel="prefetch" href="/assets/js/98.c16cc0cf.js"><link rel="prefetch" href="/assets/js/99.898c7ec7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ae13786.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>编程印象</h3> <p class="description" data-v-59e6cb88>我盼世界无 bug</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>panfeng</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="编程印象" class="logo"> <span class="site-name">编程印象</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/Devops/" class="nav-link"><i class="undefined"></i>
  Devops
</a></li><li class="dropdown-item"><!----> <a href="/categories/interviewQuestions/" class="nav-link"><i class="undefined"></i>
  interviewQuestions
</a></li><li class="dropdown-item"><!----> <a href="/categories/javaSE专题/" class="nav-link"><i class="undefined"></i>
  javaSE专题
</a></li><li class="dropdown-item"><!----> <a href="/categories/java后台框架/" class="nav-link"><i class="undefined"></i>
  java后台框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/java底层专题/" class="nav-link"><i class="undefined"></i>
  java底层专题
</a></li><li class="dropdown-item"><!----> <a href="/categories/分布式/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/学习路线/" class="nav-link"><i class="undefined"></i>
  学习路线
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/微服务/" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器/" class="nav-link"><i class="undefined"></i>
  服务器
</a></li><li class="dropdown-item"><!----> <a href="/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/categories/金三银四/" class="nav-link"><i class="undefined"></i>
  金三银四
</a></li><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/categories/html/" class="nav-link"><i class="undefined"></i>
  html
</a></li><li class="dropdown-item"><!----> <a href="/categories/js/" class="nav-link"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/categories/ts/" class="nav-link"><i class="undefined"></i>
  ts
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="undefined"></i>
  uniapp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/QYWX/" class="nav-link"><i class="undefined"></i>
  QYWX
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/项目实战/" class="nav-link"><i class="undefined"></i>
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/版本工具/" class="nav-link"><i class="undefined"></i>
  版本工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/包管理工具/" class="nav-link"><i class="undefined"></i>
  包管理工具
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      工具推荐
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://codesandbox.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  codeSandbox
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://24kcs.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  正则表达式手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caniuse.com/?search=flex" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  兼容性查询(前端)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://httpbin.org/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  API请求测试
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ps.gaoding.com/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  在线PS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  编程语言排行榜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.remove.bg/zh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  一键去除背景
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://snippet-generator.app/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  快速生成代码片段
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/pf_java_development" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-1fad0c41 data-v-5bb33761><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    panfeng
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>534</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>67</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/Devops/" class="nav-link"><i class="undefined"></i>
  Devops
</a></li><li class="dropdown-item"><!----> <a href="/categories/interviewQuestions/" class="nav-link"><i class="undefined"></i>
  interviewQuestions
</a></li><li class="dropdown-item"><!----> <a href="/categories/javaSE专题/" class="nav-link"><i class="undefined"></i>
  javaSE专题
</a></li><li class="dropdown-item"><!----> <a href="/categories/java后台框架/" class="nav-link"><i class="undefined"></i>
  java后台框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/java底层专题/" class="nav-link"><i class="undefined"></i>
  java底层专题
</a></li><li class="dropdown-item"><!----> <a href="/categories/分布式/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/学习路线/" class="nav-link"><i class="undefined"></i>
  学习路线
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/微服务/" class="nav-link"><i class="undefined"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/服务器/" class="nav-link"><i class="undefined"></i>
  服务器
</a></li><li class="dropdown-item"><!----> <a href="/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/categories/金三银四/" class="nav-link"><i class="undefined"></i>
  金三银四
</a></li><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/categories/html/" class="nav-link"><i class="undefined"></i>
  html
</a></li><li class="dropdown-item"><!----> <a href="/categories/js/" class="nav-link"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/categories/ts/" class="nav-link"><i class="undefined"></i>
  ts
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="undefined"></i>
  uniapp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/QYWX/" class="nav-link"><i class="undefined"></i>
  QYWX
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/项目实战/" class="nav-link"><i class="undefined"></i>
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/版本工具/" class="nav-link"><i class="undefined"></i>
  版本工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/包管理工具/" class="nav-link"><i class="undefined"></i>
  包管理工具
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      工具推荐
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://codesandbox.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  codeSandbox
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://24kcs.github.io/vue3_study/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  vue3+TS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  正则表达式手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://caniuse.com/?search=flex" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  兼容性查询(前端)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://httpbin.org/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  API请求测试
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ps.gaoding.com/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  在线PS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  编程语言排行榜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.remove.bg/zh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  一键去除背景
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://snippet-generator.app/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  快速生成代码片段
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/pf_java_development" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>谷粒商城—高可用集群</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>panfeng</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2023
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">谷粒商城—高可用集群</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>panfeng</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>8/15/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>谷粒商城</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1、k8s快速入门"><a href="#_1、k8s快速入门" class="header-anchor">#</a> 1、K8s快速入门</h2> <h3 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1）简介</h3> <p>kubernetes简称k8s。是用于自动部署，扩展和管理容器化应用程序的开源系统。
中文官网：https://kubernetes.io/Zh/
中文社区：https://www.kubernetes.org.cn/
官方文档：https://kubernetes.io/zh/docs/home/
社区文档：https://docs.kubernetes.org.cn/</p> <p>部署方式的进化：</p> <p><img src="https://d33wubrfki0l68.cloudfront.net/26a177ede4d7b032362289c6fccd448fc4a91174/eb693/images/docs/container_evolution.svg" alt="部署演进"></p> <p><img src="images/image-20200503105948619.png" alt="image-20200503105948619"></p> <p><img src="images/image-20200503110101659.png" alt="image-20200503110101659"></p> <h3 id="_2-架构"><a href="#_2-架构" class="header-anchor">#</a> 2）架构</h3> <h4 id="_1-整体主从方式"><a href="#_1-整体主从方式" class="header-anchor">#</a> （1）整体主从方式</h4> <p><img src="images/image-20200503110244940.png" alt="image-20200503110244940"></p> <p><img src="images/image-20200503110350256.png" alt="image-20200503110350256"></p> <h4 id="_2-master节点架构"><a href="#_2-master节点架构" class="header-anchor">#</a> （2）master节点架构</h4> <p><img src="images/image-20200503110458806.png" alt="image-20200503110458806"></p> <p><img src="images/image-20200503110631219.png" alt="image-20200503110631219"></p> <p><img src="images/image-20200503110732773.png" alt="image-20200503110732773"></p> <h4 id="_3-node节点架构"><a href="#_3-node节点架构" class="header-anchor">#</a> （3）Node节点架构</h4> <p><img src="images/image-20200503110804361.png" alt="image-20200503110804361"></p> <p><img src="images/image-20200503111032457.png" alt="image-20200503111032457"></p> <h3 id="_3-概念"><a href="#_3-概念" class="header-anchor">#</a> 3）概念</h3> <p><img src="images/image-20200503112551188.png" alt="image-20200503112551188"></p> <p><img src="images/image-20200503112627449.png" alt="image-20200503112627449"></p> <p><img src="images/image-20200503112723747.png" alt="image-20200503112723747"></p> <p><img src="images/image-20200503112810938.png" alt="image-20200503112810938"></p> <p><img src="images/image-20200503113055314.png" alt="image-20200503113055314"></p> <p><img src="images/image-20200503113619233.png" alt="image-20200503113619233"></p> <p><img src="images/image-20200503113701902.png" alt="image-20200503113701902"></p> <h3 id="_4-快速体验"><a href="#_4-快速体验" class="header-anchor">#</a> 4）快速体验</h3> <h4 id="_1-安装minikube"><a href="#_1-安装minikube" class="header-anchor">#</a> （1）安装minikube</h4> <p>https://github.com/kubernetes/minikube/releases
下载minikuber-windows-amd64.exe 改名为minikube.exe
打开virtualBox，打开cmd
运行
minikube start --vm-driver=virtualbox --registry-mirror=https://registry.docker-cn.com
等待20分钟即可。</p> <h4 id="_2-体验nginx部署升级"><a href="#_2-体验nginx部署升级" class="header-anchor">#</a> （2）体验nginx部署升级</h4> <ol><li><p>提交一个nginx deployment
kubectl apply -f https://k8s.io/examples/application/deployment.yaml</p></li> <li><p>升级 nginx deployment
kubectl apply -f https://k8s.io/examples/application/deployment-update.yaml</p></li> <li><p>扩容 nginx deployment</p></li></ol> <h2 id="_2、k8s集群安装"><a href="#_2、k8s集群安装" class="header-anchor">#</a> 2、K8s集群安装</h2> <h3 id="_1-kubeadm"><a href="#_1-kubeadm" class="header-anchor">#</a> 1）kubeadm</h3> <p>kubeadm是官方社区推出的一个用于快速部署kuberneters集群的工具。
这个工具能通过两条指令完成一个kuberneters集群的部署</p> <p>创建一个master节点</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kuberneters init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将一个node节点加入到当前集群中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubeadm join &lt;Master节点的IP和端口&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-前置要求"><a href="#_2-前置要求" class="header-anchor">#</a> 2）前置要求</h3> <p>一台或多台机器，操作系统Centos7.x-86_x64
硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多
集群中所有的机器之间网络互通
可以访问外网，需要拉取镜像
禁止Swap分区</p> <h3 id="_3-部署步骤"><a href="#_3-部署步骤" class="header-anchor">#</a> 3）部署步骤</h3> <ol><li>在所有的节点上安装Docker和kubeadm</li> <li>不是Kubernetes Master</li> <li>部署容器网络插件</li> <li>部署Kubernetes Node，将节点加入Kubernetes集群中</li> <li>部署DashBoard web页面，可视化查看Kubernetes资源</li></ol> <p><img src="images/image-20200503144120720.png" alt="image-20200503144120720"></p> <h3 id="_4-环境准备"><a href="#_4-环境准备" class="header-anchor">#</a> 4）环境准备</h3> <h4 id="_1-准备工作"><a href="#_1-准备工作" class="header-anchor">#</a> （1）准备工作</h4> <ul><li>我们可以使用vagrant快速创建三个虚拟机。虚拟机启动前先设置virtualbox的主机网络。现在全部统一为192.168.56.1，以后所有虚拟机都是56.x的ip地址。</li></ul> <p><img src="images/image-20200503175351320.png" alt="image-20200503175351320"></p> <ul><li>在全局设定中，找到一个空间比较大的磁盘用用来存放镜像。</li></ul> <p><img src="images/image-20200503180202640.png" alt="image-20200503180202640"></p> <h4 id="_2-启动三个虚拟机"><a href="#_2-启动三个虚拟机" class="header-anchor">#</a> （2）启动三个虚拟机</h4> <ul><li>使用我们提供的vagrant文件，复制到非中文无空格目录下，运行vagrant up启动三个虚拟机。其实vagrant完全可以一键部署全部K8s集群
https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster
http://github.com/davidkbainbridge/k8s-playground</li></ul> <p>下面是vagrantfile，使用它来创建三个虚拟机，分别为k8s-node1，k8s-node2和k8s-node3.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>Vagrant.configure(&quot;2&quot;) do <span class="token punctuation">|</span>config<span class="token punctuation">|</span>
   (1..3).each do <span class="token punctuation">|</span>i<span class="token punctuation">|</span>
        config.vm.define &quot;k8s<span class="token punctuation">-</span>node<span class="token comment">#{i}&quot; do |node|</span>
            <span class="token comment"># 设置虚拟机的Box</span>
            node.vm.box = &quot;centos/7&quot;

            <span class="token comment"># 设置虚拟机的主机名</span>
            node.vm.hostname=&quot;k8s<span class="token punctuation">-</span>node<span class="token comment">#{i}&quot;</span>

            <span class="token comment"># 设置虚拟机的IP</span>
            node.vm.network &quot;private_network&quot;<span class="token punctuation">,</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> <span class="token string">&quot;192.168.56.#{99+i}&quot;</span><span class="token punctuation">,</span> <span class="token key atrule">netmask</span><span class="token punctuation">:</span> <span class="token string">&quot;255.255.255.0&quot;</span>

            <span class="token comment"># 设置主机与虚拟机的共享目录</span>
            <span class="token comment"># node.vm.synced_folder &quot;~/Documents/vagrant/share&quot;, &quot;/home/vagrant/share&quot;</span>

            <span class="token comment"># VirtaulBox相关配置</span>
            node.vm.provider &quot;virtualbox&quot; do <span class="token punctuation">|</span>v<span class="token punctuation">|</span>
                <span class="token comment"># 设置虚拟机的名称</span>
                v.name = &quot;k8s<span class="token punctuation">-</span>node<span class="token comment">#{i}&quot;</span>
                <span class="token comment"># 设置虚拟机的内存大小</span>
                v.memory = 4096
                <span class="token comment"># 设置虚拟机的CPU个数</span>
                v.cpus = 4
            end
        end
   end
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>进入到三个虚拟机，开启root的密码访问权限</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Vagrant <span class="token function">ssh</span> xxx进入到系统后

<span class="token function">su</span> root 密码为vagrant

<span class="token function">vi</span> /etc/ssh/sshd_config

修改
PermitRootLogin <span class="token function">yes</span> 
PasswordAuthentication <span class="token function">yes</span>

所有的虚拟机设为4核4G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>关于在&quot;网络地址转换&quot;的连接方式下，三个节点的eth0，IP地址相同的问题。</p> <p>**问题描述：**查看k8s-node1的路由表：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@k8s-node1 ~]# ip route show
default via 10.0.2.2 dev eth0 proto dhcp metric 100 
10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100 
192.168.56.0/24 dev eth1 proto kernel scope link src 192.168.56.100 metric 101 
[root@k8s-node1 ~
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>能够看到路由表中记录的是，通过端口eth0进行数据包的收发。</p> <p>分别查看k8s-node1，k8s-node2和k8s-node3的eth0所绑定的IP地址，发现它们都是相同的，全都是10.0.2.15，这些地址是供kubernetes集群通信用的，区别于eth1上的IP地址，是通远程管理使用的。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># ip addr</span>
<span class="token punctuation">..</span>.
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.0</span>.2.15/24 brd <span class="token number">10.0</span>.2.255 scope global noprefixroute dynamic eth0
       valid_lft 84418sec preferred_lft 84418sec
    inet6 fe80::5054:ff:fe8a:fee6/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 08:00:27:a3:ca:c0 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.56.100/24 brd <span class="token number">192.168</span>.56.255 scope global noprefixroute eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea3:cac0/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>**原因分析：**这是因为它们使用是端口转发规则，使用同一个地址，通过不同的端口来区分。但是这种端口转发规则在以后的使用中会产生很多不必要的问题，所以需要修改为NAT网络类型。</p> <p><img src="images/image-20200503184536343.png" alt="image-20200503184536343"></p> <p><strong>解决方法：</strong></p> <ul><li>选择三个节点，然后执行“管理”-&gt;&quot;全局设定&quot;-&gt;“网络”，添加一个NAT网络。</li></ul> <img src="images/image-20200503184919936.png" alt="image-20200503184919936" style="zoom:67%;"> <ul><li>分别修改每台设备的网络类型，并刷新重新生成MAC地址。</li></ul> <img src="images/image-20200503185344246.png" alt="image-20200503185344246" style="zoom:50%;"> <ul><li>再次查看三个节点的IP</li></ul> <img src="images/image-20200503190101156.png" alt="image-20200503190101156" style="zoom:50%;"> <h4 id="_3-设置linux环境-三个节点都执行"><a href="#_3-设置linux环境-三个节点都执行" class="header-anchor">#</a> （3）设置Linux环境（三个节点都执行）</h4> <ul><li>关闭防火墙</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>关闭Linux</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>sed -i 's/enforcing/disabled/' /etc/selinux/config
setenforce 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>关闭swap</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>swapoff <span class="token parameter variable">-a</span> <span class="token comment">#临时关闭</span>
<span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab <span class="token comment">#永久关闭</span>
<span class="token function">free</span> <span class="token parameter variable">-g</span> <span class="token comment">#验证，swap必须为0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>添加主机名与IP对应关系：</li></ul> <p>查看主机名：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hostname
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果主机名不正确，可以通过“hostnamectl set-hostname &lt;newhostname&gt; :指定新的hostname”命令来进行修改。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vi</span> /etc/hosts
<span class="token number">10.0</span>.2.15 k8s-node1
<span class="token number">10.0</span>.2.4 k8s-node2
<span class="token number">10.0</span>.2.5 k8s-node3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>将桥接的IPV4流量传递到iptables的链：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF

net.bridge.bridge-nf-call-ip6tables = 1

net.bridge.bridge-nf-call-iptables = 1

EOF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>应用规则：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sysctl --system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>疑难问题：遇见提示是只读的文件系统，运行如下命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mount -o remount rw /
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>date 查看时间（可选）</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> ntpupdate

ntpupdate time.window.com <span class="token comment">#同步最新时间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_5-所有节点安装docker、kubeadm、kubelet、kubectl"><a href="#_5-所有节点安装docker、kubeadm、kubelet、kubectl" class="header-anchor">#</a> 5）所有节点安装docker、kubeadm、kubelet、kubectl</h3> <p>Kubenetes默认CRI（容器运行时）为Docker，因此先安装Docker。</p> <h4 id="_1-安装docker"><a href="#_1-安装docker" class="header-anchor">#</a> （1）安装Docker</h4> <p>1、卸载之前的docker</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2、安装Docker  -CE</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils

$ <span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
    
$ <span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3、配置镜像加速</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://ke9h1pt4.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>4、启动Docker &amp;&amp; 设置docker开机启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>基础环境准备好，可以给三个虚拟机备份一下；</p> <p><img src="images/image-20200503192940651.png" alt="image-20200503192940651"></p> <h4 id="_2-添加阿里与yum源"><a href="#_2-添加阿里与yum源" class="header-anchor">#</a> （2）添加阿里与Yum源</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>更多详情见： https://developer.aliyun.com/mirror/kubernetes</p> <h4 id="_3-安装kubeadm-kubelet和kubectl"><a href="#_3-安装kubeadm-kubelet和kubectl" class="header-anchor">#</a> （3）安装kubeadm，kubelet和kubectl</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum list|grep kube
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>开机启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看kubelet的状态：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl status kubelet
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看kubelet版本：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubelet --version</span>
Kubernetes v1.17.3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-部署k8s-master"><a href="#_6-部署k8s-master" class="header-anchor">#</a> 6）部署k8s-master</h3> <h4 id="_1-master节点初始化"><a href="#_1-master节点初始化" class="header-anchor">#</a> （1）master节点初始化</h4> <p>在Master节点上，创建并执行master_images.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">images</span><span class="token operator">=</span><span class="token punctuation">(</span>
	kube-apiserver:v1.17.3
    kube-proxy:v1.17.3
	kube-controller-manager:v1.17.3
	kube-scheduler:v1.17.3
	coredns:1.6.5
	etcd:3.4.3-0
    pause:3.1
<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">imageName</span> <span class="token keyword">in</span> <span class="token variable">${images<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">$imageName</span>
<span class="token comment">#   docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName  k8s.gcr.io/$imageName</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>初始化kubeadm</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ kubeadm init <span class="token punctuation">\</span>
--apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.0</span>.2.15 <span class="token punctuation">\</span>
--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span class="token punctuation">\</span>
--kubernetes-version   v1.17.3 <span class="token punctuation">\</span>
--service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/16  <span class="token punctuation">\</span>
--pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注：</p> <ul><li>--apiserver-advertise-address=10.0.2.21 ：这里的IP地址是master主机的地址，为上面的eth0网卡的地址；</li> <li></li></ul> <p>执行结果：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># kubeadm init \</span>
<span class="token operator">&gt;</span> --apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.0</span>.2.15 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> --kubernetes-version   v1.17.3 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> --service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/16  <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16
W0503 <span class="token number">14</span>:07:12.594252   <span class="token number">10124</span> configset.go:202<span class="token punctuation">]</span> WARNING: kubeadm cannot validate component configs <span class="token keyword">for</span> API <span class="token function">groups</span> <span class="token punctuation">[</span>kubelet.config.k8s.io kubeproxy.config.k8s.io<span class="token punctuation">]</span>
<span class="token punctuation">[</span>init<span class="token punctuation">]</span> Using Kubernetes version: v1.17.3
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
        <span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">&quot;cgroupfs&quot;</span> as the Docker cgroup driver. The recommended driver is <span class="token string">&quot;systemd&quot;</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Pulling images required <span class="token keyword">for</span> setting up a Kubernetes cluster
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> This might take a minute or two, depending on the speed of your internet connection
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> You can also perform this action <span class="token keyword">in</span> beforehand using <span class="token string">'kubeadm config images pull'</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/config.yaml&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Using certificateDir folder <span class="token string">&quot;/etc/kubernetes/pki&quot;</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> apiserver serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.96</span>.0.1 <span class="token number">10.0</span>.2.15<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver-kubelet-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;front-proxy-ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;front-proxy-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/server&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/server serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.0</span>.2.15 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/peer&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/peer serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.0</span>.2.15 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/healthcheck-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver-etcd-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;sa&quot;</span> key and public key
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Using kubeconfig folder <span class="token string">&quot;/etc/kubernetes&quot;</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;admin.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;kubelet.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;controller-manager.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;scheduler.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Using manifest folder <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-apiserver&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-controller-manager&quot;</span>
W0503 <span class="token number">14</span>:07:30.908642   <span class="token number">10124</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">&quot;Node,RBAC&quot;</span><span class="token punctuation">;</span> using <span class="token string">&quot;Node,RBAC&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-scheduler&quot;</span>
W0503 <span class="token number">14</span>:07:30.911330   <span class="token number">10124</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">&quot;Node,RBAC&quot;</span><span class="token punctuation">;</span> using <span class="token string">&quot;Node,RBAC&quot;</span>
<span class="token punctuation">[</span>etcd<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token builtin class-name">local</span> etcd <span class="token keyword">in</span> <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span>
<span class="token punctuation">[</span>wait-control-plane<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span><span class="token builtin class-name">.</span> This can take up to 4m0s
<span class="token punctuation">[</span>apiclient<span class="token punctuation">]</span> All control plane components are healthy after <span class="token number">22.506521</span> seconds
<span class="token punctuation">[</span>upload-config<span class="token punctuation">]</span> Storing the configuration used <span class="token keyword">in</span> ConfigMap <span class="token string">&quot;kubeadm-config&quot;</span> <span class="token keyword">in</span> the <span class="token string">&quot;kube-system&quot;</span> Namespace
<span class="token punctuation">[</span>kubelet<span class="token punctuation">]</span> Creating a ConfigMap <span class="token string">&quot;kubelet-config-1.18&quot;</span> <span class="token keyword">in</span> namespace kube-system with the configuration <span class="token keyword">for</span> the kubelets <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>upload-certs<span class="token punctuation">]</span> Skipping phase. Please see --upload-certs
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> k8s-node1 as control-plane by adding the label <span class="token string">&quot;node-role.kubernetes.io/master=''&quot;</span>
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> k8s-node1 as control-plane by adding the taints <span class="token punctuation">[</span>node-role.kubernetes.io/master:NoSchedule<span class="token punctuation">]</span>
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Using token: sg47f3.4asffoi6ijb8ljhq
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to get nodes
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="token keyword">in</span> order <span class="token keyword">for</span> nodes to get long term certificate credentials
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow certificate rotation <span class="token keyword">for</span> all <span class="token function">node</span> client certificates <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Creating the <span class="token string">&quot;cluster-info&quot;</span> ConfigMap <span class="token keyword">in</span> the <span class="token string">&quot;kube-public&quot;</span> namespace
<span class="token punctuation">[</span>kubelet-finalize<span class="token punctuation">]</span> Updating <span class="token string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy
<span class="token comment">#表示kubernetes已经初始化成功了</span>
Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 <span class="token parameter variable">--token</span> sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb 
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p>由于默认拉取镜像地址k8s.cr.io国内无法访问，这里指定阿里云仓库地址。可以手动按照我们的images.sh先拉取镜像。</p> <p>地址变为：registry.aliyuncs.com/googole_containers也可以。
科普：无类别域间路由（Classless Inter-Domain Routing 、CIDR）是一个用于给用户分配IP地址以及在互联网上有效第路由IP数据包的对IP地址进行归类的方法。
拉取可能失败，需要下载镜像。</p> <p>运行完成提前复制：加入集群的令牌。</p> <h4 id="_2-测试kubectl-主节点执行"><a href="#_2-测试kubectl-主节点执行" class="header-anchor">#</a> （2）测试Kubectl（主节点执行）</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>详细部署文档：https://kubernetes.io/docs/concepts/cluster-administration/addons/</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ kubectl get nodes <span class="token comment">#获取所有节点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>目前Master状态为notready。等待网络加入完成即可。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ journalctl <span class="token parameter variable">-u</span> kubelet <span class="token comment">#查看kubelet日志</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 <span class="token parameter variable">--token</span> sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_7-安装pod网络插件-cni"><a href="#_7-安装pod网络插件-cni" class="header-anchor">#</a> 7）安装POD网络插件（CNI）</h3> <p>在master节点上执行按照POD网络插件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f \
https://raw.githubusercontent.com/coreos/flanne/master/Documentation/kube-flannel.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以上地址可能被墙，可以直接获取本地已经下载的flannel.yml运行即可，如：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f  kube-flannel.yml    </span>
podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds-amd64 created
daemonset.apps/kube-flannel-ds-arm64 created
daemonset.apps/kube-flannel-ds-arm created
daemonset.apps/kube-flannel-ds-ppc64le created
daemonset.apps/kube-flannel-ds-s390x created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>同时flannel.yml中指定的images访问不到可以去docker hub找一个wget yml地址
vi 修改yml 所有amd64的地址修改了即可
等待大约3分钟
kubectl get pods -n kube-system 查看指定名称空间的pods
kubectl get pods -all-namespace 查看所有名称空间的pods</p> <p>$ ip link set cni0 down 如果网络出现问题，关闭cni0，重启虚拟机继续测试
执行watch kubectl get pod -n kube-system -o wide 监控pod进度
等待3-10分钟，完全都是running以后继续</p> <p>查看命名空间：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@k8s-node1 k8s]# kubectl get ns
NAME              STATUS   AGE
default           Active   30m
kube-node-lease   Active   30m
kube-public       Active   30m
kube-system       Active   30m
[root@k8s-node1 k8s]#
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces       </span>
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
kube-system   coredns-546565776c-9sbmk            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          31m
kube-system   coredns-546565776c-t68mr            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          31m
kube-system   etcd-k8s-node1                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m50s
kube-system   kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>查看master上的节点信息：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME        STATUS   ROLES    AGE   VERSION
k8s-node1   Ready    master   34m   v1.17.3   <span class="token comment">#status为ready才能够执行下面的命令</span>
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>最后再次执行，并且分别在“k8s-node2”和“k8s-node3”上也执行这里命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 <span class="token parameter variable">--token</span> sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes;</span>
NAME        STATUS     ROLES    AGE   VERSION
k8s-node1   Ready      master   47m   v1.17.3
k8s-node2   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   75s   v1.17.3
k8s-node3   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   76s   v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>监控pod进度</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">watch</span> kubectl get pod <span class="token parameter variable">-n</span> kube-system <span class="token parameter variable">-o</span> wide
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>等到所有的status都变为running状态后，再次查看节点信息：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#  kubectl get nodes;                         </span>
NAME        STATUS   ROLES    AGE     VERSION
k8s-node1   Ready    master   3h50m   v1.17.3
k8s-node2   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   3h3m    v1.17.3
k8s-node3   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   3h3m    v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_8-加入kubenetes的node节点"><a href="#_8-加入kubenetes的node节点" class="header-anchor">#</a> 8）加入kubenetes的Node节点</h3> <p>在node节点中执行，向集群中添加新的节点，执行在kubeadm init 输出的kubeadm join命令；
确保node节点成功：
token过期怎么办
kubeadm token create --print-join-command</p> <h3 id="_9-入门操作kubernetes集群"><a href="#_9-入门操作kubernetes集群" class="header-anchor">#</a> 9）入门操作kubernetes集群</h3> <p>1、在主节点上部署一个tomcat</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubectl create deployment tomcat6 <span class="token parameter variable">--image</span><span class="token operator">=</span>tomcat:6.0.53-jre8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>获取所有的资源：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS              RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-cfd8g   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          41s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP   70m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">0</span>/1     <span class="token number">1</span>            <span class="token number">0</span>           41s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">0</span>       41s
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>kubectl get pods -o wide 可以获取到tomcat部署信息，能够看到它被部署到了k8s-node2上了</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all -o wide</span>
NAME                           READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
pod/tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          114s   <span class="token number">10.244</span>.2.2   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE   SELECTOR
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP   71m   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS   IMAGES               SELECTOR
deployment.apps/tomcat6   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           114s   tomcat       tomcat:6.0.53-jre8   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6

NAME                                 DESIRED   CURRENT   READY   AGE    CONTAINERS   IMAGES               SELECTOR
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       114s   tomcat       tomcat:6.0.53-jre8   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6,pod-template-hash<span class="token operator">=</span>7b84fb5fdc
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>查看node2节点上，下载了哪些镜像：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                                       TAG                 IMAGE ID            CREATED             SIZE
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy   v1.17.3             0d40868643c6        <span class="token number">2</span> weeks ago         117MB
registry.cn-hangzhou.aliyuncs.com/google_containers/pause        <span class="token number">3.2</span>                 80d28bedfe5d        <span class="token number">2</span> months ago        683kB
quay.io/coreos/flannel                                           v0.11.0-amd64       ff281650a721        <span class="token number">15</span> months ago       <span class="token number">52</span>.6MB
tomcat                                                           <span class="token number">6.0</span>.53-jre8         49ab0583115a        <span class="token number">2</span> years ago         290MB
<span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>查看Node2节点上，正在运行的容器：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE                                                            COMMAND                  CREATED             STATUS              PORTS               NAMES
9194cc4f0b7a        tomcat                                                           <span class="token string">&quot;catalina.sh run&quot;</span>        <span class="token number">2</span> minutes ago       Up <span class="token number">2</span> minutes                            k8s_tomcat_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
f44af0c7c345        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">&quot;/pause&quot;</span>                 <span class="token number">3</span> minutes ago       Up <span class="token number">3</span> minutes                            k8s_POD_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
ef74c90491e4        ff281650a721                                                     <span class="token string">&quot;/opt/bin/flanneld -…&quot;</span>   <span class="token number">20</span> minutes ago      Up <span class="token number">20</span> minutes                           k8s_kube-flannel_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
c8a524e5a193        registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy   <span class="token string">&quot;/usr/local/bin/kube…&quot;</span>   <span class="token number">25</span> minutes ago      Up <span class="token number">25</span> minutes                           k8s_kube-proxy_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
4590685c519a        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">&quot;/pause&quot;</span>                 <span class="token number">26</span> minutes ago      Up <span class="token number">26</span> minutes                           k8s_POD_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
54e00af5cde4        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">&quot;/pause&quot;</span>                 <span class="token number">26</span> minutes ago      Up <span class="token number">26</span> minutes                           k8s_POD_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
<span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在node1上执行：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5m35s

<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces</span>
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
default       tomcat6-7b84fb5fdc-cfd8g            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          163m
kube-system   coredns-546565776c-9sbmk            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   coredns-546565776c-t68mr            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   etcd-k8s-node1                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-flannel-ds-amd64-5xs5j         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h24m
kube-system   kube-flannel-ds-amd64-fvnvx         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-7tkvl                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-mvlnk                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>从前面看到tomcat部署在Node2上，现在模拟因为各种原因宕机的情况，将node2关闭电源，观察情况。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME        STATUS     ROLES    AGE     VERSION
k8s-node1   Ready      master   4h4m    v1.17.3
k8s-node2   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   3h18m   v1.17.3
k8s-node3   Ready      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   3h18m   v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME                       READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          177m   <span class="token number">10.244</span>.2.2   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="images/image-20200504104925236.png" alt="image-20200504104925236"></p> <p>2、暴露nginx访问</p> <p>在master上执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubectl expose deployment tomcat6 <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span> --target-port<span class="token operator">=</span><span class="token number">8080</span> <span class="token parameter variable">--type</span><span class="token operator">=</span>NodePort 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>pod的80映射容器的8080；server会带来pod的80</p> <p>查看服务：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        12h
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   49s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -o wide</span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE     SELECTOR
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        12h     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   3m30s   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>http://192.168.56.100:30526/</p> <p><img src="images/image-20200504105723874.png" alt="image-20200504105723874"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          13m

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        12h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   9m50s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>3、动态扩容测试</p> <p>kubectl get deployment</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
tomcat6   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>应用升级： kubectl set image (--help查看帮助)
扩容：kubectl scale --replicas=3 deployment tomcat6</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl scale --replicas=3 deployment tomcat6</span>
deployment.apps/tomcat6 scaled
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME                       READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          61s   <span class="token number">10.244</span>.2.5   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19m   <span class="token number">10.244</span>.1.2   k8s-node3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
tomcat6-7b84fb5fdc-vlrh6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          61s   <span class="token number">10.244</span>.2.4   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -o wide    </span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE   SELECTOR
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        13h   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   16m   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>扩容了多份，所有无论访问哪个node的指定端口，都可以访问到tomcat6</p> <p>http://192.168.56.101:30526/</p> <p><img src="images/image-20200504111008668.png" alt="image-20200504111008668"></p> <p>http://192.168.56.102:30526/</p> <p><img src="images/image-20200504111028496.png" alt="image-20200504111028496"></p> <p>缩容：kubectl scale --replicas=2 deployment tomcat6</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@k8s-node1 ~]#  kubectl scale --replicas=2 deployment tomcat6
deployment.apps/tomcat6 scaled
[root@k8s-node1 ~]# kubectl get pods -o wide                       
NAME                       READY   STATUS        RESTARTS   AGE     IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   0/1     Terminating   0          4m47s   &lt;none&gt;       k8s-node2   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-qt5jm   1/1     Running       0          22m     10.244.1.2   k8s-node3   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-vlrh6   1/1     Running       0          4m47s   10.244.2.4   k8s-node2   &lt;none&gt;           &lt;none&gt;
[root@k8s-node1 ~]# 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>4、以上操作的yaml获取
参照k8s细节</p> <p>5、删除
kubectl get all</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#查看所有资源</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          26m
pod/tomcat6-7b84fb5fdc-vlrh6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8m16s

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        13h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   22m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">2</span>         <span class="token number">2</span>         <span class="token number">2</span>       11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#删除deployment.apps/tomcat6 </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete  deployment.apps/tomcat6 </span>
deployment.apps <span class="token string">&quot;tomcat6&quot;</span> deleted

<span class="token comment">#查看剩余的资源</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all   </span>
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        13h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30526/TCP   30m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#删除service/tomcat6 </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete service/tomcat6  </span>
<span class="token function">service</span> <span class="token string">&quot;tomcat6&quot;</span> deleted
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP   13h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>kubectl delete deploye/nginx
kubectl delete service/nginx-service</p> <h2 id="_3、k8s细节"><a href="#_3、k8s细节" class="header-anchor">#</a> 3、K8s细节</h2> <h3 id="_1、kubectl文档"><a href="#_1、kubectl文档" class="header-anchor">#</a> 1、kubectl文档</h3> <p>​    https://kubernetes.io/zh/docs/reference/kubectl/overview/</p> <h3 id="_2、资源类型"><a href="#_2、资源类型" class="header-anchor">#</a> 2、资源类型</h3> <p>https://kubernetes.io/zh/docs/reference/kubectl/overview/#%e8%b5%84%e6%ba%90%e7%b1%bb%e5%9e%8b</p> <h3 id="_3、格式化输出"><a href="#_3、格式化输出" class="header-anchor">#</a> 3、格式化输出</h3> <p>https://kubernetes.io/zh/docs/reference/kubectl/overview/</p> <blockquote><p>所有 <code>kubectl</code> 命令的默认输出格式都是人类可读的纯文本格式。要以特定格式向终端窗口输出详细信息，可以将 <code>-o</code> 或 <code>--output</code> 参数添加到受支持的 <code>kubectl</code> 命令中。</p> <h4 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubectl <span class="token punctuation">[</span>command<span class="token punctuation">]</span> <span class="token punctuation">[</span>TYPE<span class="token punctuation">]</span> <span class="token punctuation">[</span>NAME<span class="token punctuation">]</span> <span class="token parameter variable">-o</span><span class="token operator">=</span><span class="token operator">&lt;</span>output_format<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>根据 <code>kubectl</code> 操作，支持以下输出格式：</p> <table><thead><tr><th style="text-align:left;">Output format</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>-o custom-columns=</code></td> <td style="text-align:left;">使用逗号分隔的<a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns" target="_blank" rel="noopener noreferrer">自定义列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>列表打印表。</td></tr> <tr><td style="text-align:left;"><code>-o custom-columns-file=</code></td> <td style="text-align:left;">使用 `` 文件中的<a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns" target="_blank" rel="noopener noreferrer">自定义列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>模板打印表。</td></tr> <tr><td style="text-align:left;"><code>-o json</code></td> <td style="text-align:left;">输出 JSON 格式的 API 对象</td></tr> <tr><td style="text-align:left;">`-o jsonpath=</td> <td style="text-align:left;">打印 <a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener noreferrer">jsonpath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表达式定义的字段</td></tr> <tr><td style="text-align:left;"><code>-o jsonpath-file=</code></td> <td style="text-align:left;">打印 `` 文件中 <a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener noreferrer">jsonpath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表达式定义的字段。</td></tr> <tr><td style="text-align:left;"><code>-o name</code></td> <td style="text-align:left;">仅打印资源名称而不打印任何其他内容。</td></tr> <tr><td style="text-align:left;"><code>-o wide</code></td> <td style="text-align:left;">以纯文本格式输出，包含任何附加信息。对于 pod 包含节点名。</td></tr> <tr><td style="text-align:left;"><code>-o yaml</code></td> <td style="text-align:left;">输出 YAML 格式的 API 对象。</td></tr></tbody></table> <h5 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h5> <p>在此示例中，以下命令将单个 pod 的详细信息输出为 YAML 格式的对象：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubectl get pod web-pod-13je7 <span class="token parameter variable">-o</span> yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>请记住：有关每个命令支持哪种输出格式的详细信息，请参阅 <a href="https://kubernetes.io/docs/user-guide/kubectl/" target="_blank" rel="noopener noreferrer">kubectl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 参考文档。</p></blockquote> <p>--dry-run：</p> <blockquote><p>--dry-run='none': Must be &quot;none&quot;, &quot;server&quot;, or &quot;client&quot;. If client strategy, only print the object that would be</p> <p>sent, without sending it. If server strategy, submit server-side request without persisting the resource.</p> <p>值必须为none，server或client。如果是客户端策略，则只打印该发送对象，但不发送它。如果服务器策略，提交服务器端请求而不持久化资源。</p> <p>也就是说，通过--dry-run选项，并不会真正的执行这条命令。</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml</span>
W0504 03<span class="token punctuation">:</span>39<span class="token punctuation">:</span>08.389369    8107 helpers.go<span class="token punctuation">:</span><span class="token number">535</span><span class="token punctuation">]</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>dry<span class="token punctuation">-</span>run is deprecated and can be replaced with <span class="token punctuation">-</span><span class="token punctuation">-</span>dry<span class="token punctuation">-</span>run=client.
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>实际上我们也可以将这个yaml输出到文件，然后使用kubectl apply -f来应用它</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#输出到tomcat6.yaml </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml &gt;tomcat6.yaml</span>
W0504 03:46:18.180366   <span class="token number">11151</span> helpers.go:535<span class="token punctuation">]</span> --dry-run is deprecated and can be replaced with --dry-run<span class="token operator">=</span>client.

<span class="token comment">#修改副本数为3</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># cat tomcat6.yaml </span>
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: <span class="token number">3</span>     <span class="token comment">#修改副本数为3</span>
  selector:
    matchLabels:
      app: tomcat6
  strategy: <span class="token punctuation">{</span><span class="token punctuation">}</span>
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat
        resources: <span class="token punctuation">{</span><span class="token punctuation">}</span>
status: <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">#应用tomcat6.yaml </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6.yaml </span>
deployment.apps/tomcat6 created
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>查看pods：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  </span>
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-5jh6t   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
tomcat6-7b84fb5fdc-8lhwv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
tomcat6-7b84fb5fdc-j4qmh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看某个pod的具体信息：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods tomcat6-7b84fb5fdc-5jh6t  -o yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:47Z&quot;</span>
  <span class="token key atrule">generateName</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">pod-template-hash</span><span class="token punctuation">:</span> 7b84fb5fdc
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:generateName</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token key atrule">f:app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token key atrule">f:pod-template-hash</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:ownerReferences</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;uid&quot;<span class="token punctuation">:</span><span class="token string">&quot;292bfe3b-dd63-442e-95ce-c796ab5bdcc1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:apiVersion</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:blockOwnerDeletion</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:controller</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:kind</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:uid</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token key atrule">f:spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:containers</span><span class="token punctuation">:</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;name&quot;<span class="token punctuation">:</span><span class="token string">&quot;tomcat&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:image</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:imagePullPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:terminationMessagePath</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:terminationMessagePolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:dnsPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:enableServiceLinks</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:restartPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:schedulerName</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:47Z&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:conditions</span><span class="token punctuation">:</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;type&quot;<span class="token punctuation">:</span><span class="token string">&quot;ContainersReady&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;type&quot;<span class="token punctuation">:</span><span class="token string">&quot;Initialized&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;type&quot;<span class="token punctuation">:</span><span class="token string">&quot;Ready&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:containerStatuses</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:hostIP</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:phase</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:podIP</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:podIPs</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;ip&quot;<span class="token punctuation">:</span><span class="token string">&quot;10.244.2.7&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token key atrule">f:ip</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token key atrule">f:startTime</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubelet
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:49Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>5jh6t
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">ownerReferences</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
    <span class="token key atrule">blockOwnerDeletion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">controller</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc
    <span class="token key atrule">uid</span><span class="token punctuation">:</span> 292bfe3b<span class="token punctuation">-</span>dd63<span class="token punctuation">-</span>442e<span class="token punctuation">-</span>95ce<span class="token punctuation">-</span>c796ab5bdcc1
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;46229&quot;</span>
  <span class="token key atrule">selfLink</span><span class="token punctuation">:</span> /api/v1/namespaces/default/pods/tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>5jh6t
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 2f661212<span class="token punctuation">-</span>3b03<span class="token punctuation">-</span>47e4<span class="token punctuation">-</span>bcb8<span class="token punctuation">-</span>79782d5c7578
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
    <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/run/secrets/kubernetes.io/serviceaccount
      <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
      <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
  <span class="token key atrule">enableServiceLinks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>node2
  <span class="token key atrule">priority</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
  <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">serviceAccount</span><span class="token punctuation">:</span> default
  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> default
  <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoExecute
    <span class="token key atrule">key</span><span class="token punctuation">:</span> node.kubernetes.io/not<span class="token punctuation">-</span>ready
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">300</span>
  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoExecute
    <span class="token key atrule">key</span><span class="token punctuation">:</span> node.kubernetes.io/unreachable
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">300</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
    <span class="token key atrule">secret</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">420</span>
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:47Z&quot;</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">&quot;True&quot;</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Initialized
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:49Z&quot;</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">&quot;True&quot;</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Ready
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:49Z&quot;</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">&quot;True&quot;</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ContainersReady
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:47Z&quot;</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">&quot;True&quot;</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> PodScheduled
  <span class="token key atrule">containerStatuses</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">containerID</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>//18eb0798384ea44ff68712cda9be94b6fb96265206c554a15cee28c288879304
    <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
    <span class="token key atrule">imageID</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>pullable<span class="token punctuation">:</span>//tomcat@sha256<span class="token punctuation">:</span>8c643303012290f89c6f6852fa133b7c36ea6fbb8eb8b8c9588a432beb24dc5d
    <span class="token key atrule">lastState</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
    <span class="token key atrule">ready</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">restartCount</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">started</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">state</span><span class="token punctuation">:</span>
      <span class="token key atrule">running</span><span class="token punctuation">:</span>
        <span class="token key atrule">startedAt</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:49Z&quot;</span>
  <span class="token key atrule">hostIP</span><span class="token punctuation">:</span> 10.0.2.4
  <span class="token key atrule">phase</span><span class="token punctuation">:</span> Running
  <span class="token key atrule">podIP</span><span class="token punctuation">:</span> 10.244.2.7
  <span class="token key atrule">podIPs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> 10.244.2.7
  <span class="token key atrule">qosClass</span><span class="token punctuation">:</span> BestEffort
  <span class="token key atrule">startTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-05-04T03:50:47Z&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br></div></div><h3 id="命令参考"><a href="#命令参考" class="header-anchor">#</a> 命令参考</h3> <p><img src="images/image-20200504115823058.png" alt="image-20200504115823058"></p> <h3 id="service的意义"><a href="#service的意义" class="header-anchor">#</a> service的意义</h3> <p><img src="images/image-20200504120856830.png" alt="image-20200504120856830"></p> <p>前面我们通过命令行的方式，部署和暴露了tomcat，实际上也可以通过yaml的方式来完成这些操作。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#这些操作实际上是为了获取Deployment的yaml模板</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#  kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml &gt;tomcat6-deployment.yaml</span>
W0504 04:13:28.265432   <span class="token number">24263</span> helpers.go:535<span class="token punctuation">]</span> --dry-run is deprecated and can be replaced with --dry-run<span class="token operator">=</span>client.
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># ls tomcat6-deployment.yaml</span>
tomcat6-deployment.yaml
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改“tomcat6-deployment.yaml”内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#部署</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6-deployment.yaml</span>
deployment.apps/tomcat6 configured


<span class="token comment">#查看资源</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-5jh6t   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m
pod/tomcat6-7b84fb5fdc-8lhwv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m
pod/tomcat6-7b84fb5fdc-j4qmh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP   14h

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           27m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       27m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>kubectl expose deployment tomcat6 <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span> --target-port<span class="token operator">=</span><span class="token number">8080</span> <span class="token parameter variable">--type</span><span class="token operator">=</span>NodePort  --dry-run <span class="token parameter variable">-o</span> yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">loadBalancer</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>将这段输出和“tomcat6-deployment.yaml”进行拼接，表示部署完毕并进行暴露服务：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>部署并暴露服务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6-deployment.yaml</span>
deployment.apps/tomcat6 created
service/tomcat6 created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>查看服务和部署信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-dsqmb   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4s
pod/tomcat6-7b84fb5fdc-gbmxc   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5s
pod/tomcat6-7b84fb5fdc-kjlc6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        14h
service/tomcat6      NodePort    <span class="token number">10.96</span>.147.210   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30172/TCP   4s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           5s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       5s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>访问node1，node1和node3的30172端口：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># curl -I http://192.168.56.{100,101,102}:30172/</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">&quot;7454-1491118183000&quot;</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">&quot;7454-1491118183000&quot;</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">&quot;7454-1491118183000&quot;</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h3> <p>通过Ingress发现pod进行关联。基于域名访问
通过Ingress controller实现POD负载均衡
支持TCP/UDP 4层负载均衡和HTTP 7层负载均衡</p> <p><img src="images/image-20200504123948771.png" alt="image-20200504123948771"></p> <p>步骤：
（1）部署Ingress controller</p> <p>执行“k8s/ingress-controller.yaml”</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f ingress-controller.yaml </span>
namespace/ingress-nginx created
configmap/nginx-configuration created
configmap/tcp-services created
configmap/udp-services created
serviceaccount/nginx-ingress-serviceaccount created
clusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole created
role.rbac.authorization.k8s.io/nginx-ingress-role created
rolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-binding created
clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-clusterrole-nisa-binding created
daemonset.apps/nginx-ingress-controller created
service/ingress-nginx created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>查看</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces</span>
NAMESPACE       NAME                                READY   STATUS              RESTARTS   AGE
default         tomcat6-7b84fb5fdc-dsqmb            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
default         tomcat6-7b84fb5fdc-gbmxc            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
default         tomcat6-7b84fb5fdc-kjlc6            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
ingress-nginx   nginx-ingress-controller-9q6cs      <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          40s
ingress-nginx   nginx-ingress-controller-qx572      <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          40s
kube-system     coredns-546565776c-9sbmk            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     coredns-546565776c-t68mr            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     etcd-k8s-node1                      <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-flannel-ds-amd64-5xs5j         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          13h
kube-system     kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          14h
kube-system     kube-flannel-ds-amd64-fvnvx         <span class="token number">1</span>/1     Running             <span class="token number">1</span>          13h
kube-system     kube-proxy-7tkvl                    <span class="token number">1</span>/1     Running             <span class="token number">1</span>          13h
kube-system     kube-proxy-mvlnk                    <span class="token number">1</span>/1     Running             <span class="token number">2</span>          13h
kube-system     kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这里master节点负责调度，具体执行交给node2和node3来完成，能够看到它们正在下载镜像</p> <p><img src="images/image-20200504124608258.png" alt="image-20200504124608258"></p> <p>（2）创建Ingress规则</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tomcat6.kubenetes.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
       <span class="token key atrule">paths</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> <span class="token key atrule">backend</span><span class="token punctuation">:</span> 
              <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> tomcat6
              <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># touch ingress-tomcat6.yaml</span>
<span class="token comment">#将上面的规则，添加到ingress-tomcat6.yaml文件中</span>
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># vi  ingress-tomcat6.yaml  </span>
 
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f ingress-tomcat6.yaml </span>
ingress.extensions/web created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>修改本机的hosts文件，添加如下的域名转换规则：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>192.168.56.102 tomcat6.kubenetes.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试: http://tomcat6.kubenetes.com/</p> <p><img src="images/image-20200504131325267.png" alt="image-20200504131325267"></p> <p>并且集群中即便有一个节点不可用，也不影响整体的运行。</p> <h2 id="安装kubernetes可视化界面-dashboard"><a href="#安装kubernetes可视化界面-dashboard" class="header-anchor">#</a> 安装kubernetes可视化界面——DashBoard</h2> <p>1、部署DashBoard</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ kubectl appy <span class="token parameter variable">-f</span>  kubernetes-dashboard.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>文件在“k8s”源码目录提供</p> <p>2、暴露DashBoard为公共访问</p> <p>默认DashBoard只能集群内部访问，修改Service为NodePort类型，暴露到外部</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">3001</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>访问地址：http://NodeIP:30001</p> <p>3、创建授权账号</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl create serviceaccount dashboar-admin -n kube-sysem
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl create clusterrolebinding dashboar-admin --clusterrole=cluter-admin --serviceaccount=kube-system:dashboard-admin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>$ kubectl describe secrets -n kube-system $( kubectl -n kube-system get secret |awk '/dashboard-admin/{print $1}' )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用输出的token登录dashboard</p> <p><img src="images/image-20200504153630775.png" alt="image-20200504153630775"></p> <h2 id="kubesphere"><a href="#kubesphere" class="header-anchor">#</a> kubesphere</h2> <p>默认的dashboard没啥用，我们用kubesphere可以打通全部的devops链路，kubesphere集成了很多套件，集群要求比较高
https://kubesphere.io</p> <p>kuboard也很不错，集群要求不高
https://kuboard.cn/support/</p> <h3 id="_1、简洁"><a href="#_1、简洁" class="header-anchor">#</a> 1、简洁</h3> <p>kubesphere是一款面向云原声设计的开源项目，在目前主流容器调度平台kubernets智商构建的分布式多用户容器管理平台，提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大降低开发、测试、运维的日常工作的复杂度。</p> <h3 id="_2、安装前提提交"><a href="#_2、安装前提提交" class="header-anchor">#</a> 2、安装前提提交</h3> <h4 id="_1、安装helm-master节点执行"><a href="#_1、安装helm-master节点执行" class="header-anchor">#</a> 1、安装helm（master节点执行）</h4> <p>helm是kubernetes的包管理器。包管理器类似于在Ubuntu中使用的apt，centos中的yum或者python中的pip一样，能够快速查找，下载和安装软件包。Helm有客户端组件helm和服务端组件Tiller组成，能够将一组K8S资源打包统一管理，是查找、共享和使用为Kubernetes构建的软件的最佳方式。</p> <p>1）安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -L https://git.io/get_helm.sh|bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于被墙的原因，使用我们给定的get_helm.sh。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">68</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">7149</span> Feb <span class="token number">27</span> 01:58 get_helm.sh
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">6310</span> Feb <span class="token number">28</span> 05:16 ingress-controller.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">209</span> Feb <span class="token number">28</span> <span class="token number">13</span>:18 ingress-demo.yml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">236</span> May  <span class="token number">4</span> 05:09 ingress-tomcat6.yaml
-rwxr--r-- <span class="token number">1</span> root root <span class="token number">15016</span> Feb <span class="token number">26</span> <span class="token number">15</span>:05 kube-flannel.yml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">4737</span> Feb <span class="token number">26</span> <span class="token number">15</span>:38 kubernetes-dashboard.yaml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">3841</span> Feb <span class="token number">27</span> 01:09 kubesphere-complete-setup.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">392</span> Feb <span class="token number">28</span> <span class="token number">11</span>:33 master_images.sh
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">283</span> Feb <span class="token number">28</span> <span class="token number">11</span>:34 node_images.sh
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">1053</span> Feb <span class="token number">28</span> 03:53 product.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">931</span> May  <span class="token number">3</span> <span class="token number">10</span>:08 Vagrantfile
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># sh get_helm.sh </span>
Downloading https://get.helm.sh/helm-v2.16.6-linux-amd64.tar.gz
Preparing to <span class="token function">install</span> helm and tiller into /usr/local/bin
helm installed into /usr/local/bin/helm
tiller installed into /usr/local/bin/tiller
Run <span class="token string">'helm init'</span> to configure helm.
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>2）验证版本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3）创建权限（master执行）</p> <p>创建helm-rbac.yaml，写入如下内容</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tiller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tiller
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>应用配置：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl apply -f helm-rbac.yaml</span>
serviceaccount/tiller created
clusterrolebinding.rbac.authorization.k8s.io/tiller created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2、安装tilller-master执行"><a href="#_2、安装tilller-master执行" class="header-anchor">#</a> 2、安装Tilller（Master执行）</h4> <p>1、初始化</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># helm init --service-account=tiller --tiller-image=sapcc/tiller:v2.16.3 --history-max 300 </span>
Creating /root/.helm 
Creating /root/.helm/repository 
Creating /root/.helm/repository/cache 
Creating /root/.helm/repository/local 
Creating /root/.helm/plugins 
Creating /root/.helm/starters 
Creating /root/.helm/cache/archive 
Creating /root/.helm/repository/repositories.yaml 
Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com 
Adding <span class="token builtin class-name">local</span> repo with URL: http://127.0.0.1:8879/charts 
<span class="token variable">$HELM_HOME</span> has been configured at /root/.helm.

Tiller <span class="token punctuation">(</span>the Helm server-side component<span class="token punctuation">)</span> has been installed into your Kubernetes Cluster.

Please note: by default, Tiller is deployed with an insecure <span class="token string">'allow unauthenticated users'</span> policy.
To prevent this, run <span class="token variable"><span class="token variable">`</span>helm init<span class="token variable">`</span></span> with the --tiller-tls-verify flag.
For <span class="token function">more</span> information on securing your installation see: https://v2.helm.sh/docs/securing_installation/
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>--tiller-image 指定镜像，否则会被墙，等待节点上部署的tiller完成即可。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl get pods -n kube-system</span>
NAME                                   READY   STATUS             RESTARTS   AGE
coredns-546565776c-9sbmk               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
coredns-546565776c-t68mr               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
etcd-k8s-node1                         <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-apiserver-k8s-node1               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-controller-manager-k8s-node1      <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-flannel-ds-amd64-5xs5j            <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-flannel-ds-amd64-6xwth            <span class="token number">1</span>/1     Running            <span class="token number">5</span>          23h
kube-flannel-ds-amd64-fvnvx            <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-proxy-7tkvl                       <span class="token number">1</span>/1     Running            <span class="token number">3</span>          22h
kube-proxy-mvlnk                       <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-proxy-sz2vz                       <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-scheduler-k8s-node1               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kubernetes-dashboard-975499656-jxczv   <span class="token number">0</span>/1     ImagePullBackOff   <span class="token number">0</span>          7h45m
tiller-deploy-8cc566858-67bxb          <span class="token number">1</span>/1     Running            <span class="token number">0</span>          31s
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>查看集群的所有节点信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> kubectl get node -o wide
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl get node -o wide</span>
NAME        STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
k8s-node1   Ready    master   23h   v1.17.3   <span class="token number">10.0</span>.2.15     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
k8s-node2   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   22h   v1.17.3   <span class="token number">10.0</span>.2.4      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
k8s-node3   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   22h   v1.17.3   <span class="token number">10.0</span>.2.5      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>2、测试</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm install stable/nginx-ingress --name nginx-ingress
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最小化安装 KubeSphere</p> <p>若集群可用 CPU &gt; 1 Core 且可用内存 &gt; 2 G，可以使用以下命令最小化安装 KubeSphere：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>kubectl apply <span class="token punctuation">-</span>f https<span class="token punctuation">:</span>//raw.githubusercontent.com/kubesphere/ks<span class="token punctuation">-</span>installer/master/kubesphere<span class="token punctuation">-</span>minimal.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>提示：若您的服务器提示无法访问 GitHub，可将</strong> <a href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-minimal.yaml" target="_blank" rel="noopener noreferrer">kubesphere-minimal.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>或</strong> <a href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-complete-setup.yaml" target="_blank" rel="noopener noreferrer">kubesphere-complete-setup.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>文件保存到本地作为本地的静态文件，再参考上述命令进行安装。</strong></p> <ol><li>查看滚动刷新的安装日志，请耐心等待安装成功。</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ kubectl logs <span class="token parameter variable">-n</span> kubesphere-system <span class="token variable"><span class="token variable">$(</span>kubectl get pod <span class="token parameter variable">-n</span> kubesphere-system <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>ks-install <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'{.items[0].metadata.name}'</span><span class="token variable">)</span></span> <span class="token parameter variable">-f</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>说明：安装过程中若遇到问题，也可以通过以上日志命令来排查问题。</p></blockquote></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-ac050c62></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      欢迎来到我的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="250" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://assets.smallsunnyfox.com/music/2.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://assets.smallsunnyfox.com/music/2.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://assets.smallsunnyfox.com/music/2.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>강남역 4번 출구</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Plastic / Fallin` Dild</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><canvas id="vuepress-canvas-cursor"></canvas><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/assets/js/app.3253cff9.js" defer></script><script src="/assets/js/3.fb47a76d.js" defer></script><script src="/assets/js/1.fc79f8d4.js" defer></script><script src="/assets/js/526.355d784d.js" defer></script>
  </body>
</html>
