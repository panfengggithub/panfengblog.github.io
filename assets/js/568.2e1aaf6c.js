(window.webpackJsonp=window.webpackJsonp||[]).push([[568],{980:function(s,n,t){"use strict";t.r(n);var a=t(1),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx重要知识点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx重要知识点"}},[s._v("#")]),s._v(" "),n("strong",[s._v("Nginx重要知识点")])]),s._v(" "),n("h1",{attrs:{id:"_1-什么是nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是nginx"}},[s._v("#")]),s._v(" 1. 什么是Nginx?")]),s._v(" "),n("p",[s._v("​\t\t"),n("em",[s._v("Nginx")]),s._v(" (engine x) 是一个高性能的"),n("a",{attrs:{href:"https://baike.baidu.com/item/HTTP",target:"_blank",rel:"noopener noreferrer"}},[s._v("HTTP"),n("OutboundLink")],1),s._v("和"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488",target:"_blank",rel:"noopener noreferrer"}},[s._v("反向代理"),n("OutboundLink")],1),s._v("web服务器，同时也提供了IMAP/POP3/SMTP服务。")]),s._v(" "),n("p",[s._v("​\t\tNginx是由伊戈尔·赛索耶夫为"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E4%BF%84%E7%BD%97%E6%96%AF/125568",target:"_blank",rel:"noopener noreferrer"}},[s._v("俄罗斯"),n("OutboundLink")],1),s._v("访问量第二的Rambler.ru站点（俄文：Рамблер）开发的。")]),s._v(" "),n("p",[s._v("​\t\tNginx的特点是占有内存少，"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91/11024806",target:"_blank",rel:"noopener noreferrer"}},[s._v("并发"),n("OutboundLink")],1),s._v("能力强，能够支持高达 50,000 个并发连接数的响应,事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E4%BA%AC%E4%B8%9C/210931",target:"_blank",rel:"noopener noreferrer"}},[s._v("京东"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E6%96%B0%E6%B5%AA/125692",target:"_blank",rel:"noopener noreferrer"}},[s._v("新浪"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E7%BD%91%E6%98%93/185754",target:"_blank",rel:"noopener noreferrer"}},[s._v("网易"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E8%85%BE%E8%AE%AF/112204",target:"_blank",rel:"noopener noreferrer"}},[s._v("腾讯"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E6%B7%98%E5%AE%9D/145661",target:"_blank",rel:"noopener noreferrer"}},[s._v("淘宝"),n("OutboundLink")],1),s._v("等。")]),s._v(" "),n("p",[s._v("​\t\tNginx支持正向代理、反向代理、负载均衡和动静分离。接下来一一介绍。")]),s._v(" "),n("h2",{attrs:{id:"_1-1-正向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-正向代理"}},[s._v("#")]),s._v(" 1.1 正向代理")]),s._v(" "),n("p",[s._v("​\t\t在如今的网络环境下，我们如果由于技术需要要去访问国外的某些网站，此时你会发现位于国外的某网站我们通过浏览器是没有办法访问的，此时大家可能都会用一个代理(vpn)进行访问，代理的方式主要是找到一个可以访问国外网站的代理服务器，我们将请求发送给代理服务器，代理服务器去访问国外的网站，然后将访问到的数据传递给我们！")]),s._v(" "),n("p",[s._v('​\t\tNginx支持正向代理，"它代理的是客户端"，是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。')]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035239-7a2b8961-1487-4dd7-9c1c-03cf00016e15.png",alt:"img"}})]),s._v(" "),n("p",[s._v("客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。如图。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035172-eea2a1ad-7f1b-4b53-8dd8-a6f8578d95b8.png",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("正向代理的用途：")])]),s._v(" "),n("p",[s._v("（1）访问原来无法访问的资源，如Google")]),s._v(" "),n("p",[s._v("（2） 可以做缓存，加速访问资源")]),s._v(" "),n("p",[s._v("（3）对客户端访问授权，上网进行认证")]),s._v(" "),n("p",[s._v("（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息")]),s._v(" "),n("h2",{attrs:{id:"_1-2-反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-反向代理"}},[s._v("#")]),s._v(" 1.2 反向代理")]),s._v(" "),n("p",[s._v("​\t\t明白了什么是正向代理，我们继续看关于反向代理的处理方式，举例如我大天朝的某宝网站，每天同时连接到网站的访问人数已经爆表，单个服务器远远不能满足人民日益增长的购买欲望了，此时就出现了一个大家耳熟能详的名词：分布式部署；也就是通过部署多台服务器来解决访问人数限制的问题；某宝网站中大部分功能也是直接使用Nginx进行反向代理实现的，并且通过封装Nginx和其他的组件之后起了个高大上的名字：Tengine，有兴趣的童鞋可以访问Tengine的官网查看具体的信息：http://tengine.taobao.org/。")]),s._v(" "),n("p",[s._v("Tengine是一个由淘宝网发起的Web服务器开源项目，其核心成员来自于"),n("a",{attrs:{href:"http://www.taobao.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("淘宝"),n("OutboundLink")],1),s._v(" 、"),n("a",{attrs:{href:"http://www.sogou.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("搜狗"),n("OutboundLink")],1),s._v(" 等互联网企业。它在"),n("a",{attrs:{href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx"),n("OutboundLink")],1),s._v(" 的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如"),n("a",{attrs:{href:"http://www.taobao.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("淘宝网"),n("OutboundLink")],1),s._v(" ，"),n("a",{attrs:{href:"http://www.tmall.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("天猫商城"),n("OutboundLink")],1),s._v(" 等得到了很好的检验。它的最终目标是打造一个高效、稳定、安全、易用的Web平台。")]),s._v(" "),n("p",[s._v('​\t\tNginx支持反向代理，"它代理的是服务端，代服务端接收请求"，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。多个客户端给服务器发送的请求，'),n("strong",[s._v("Nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理")]),s._v("了。请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，Nginx扮演的就是一个反向代理角色。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035335-708a9d56-29ed-4ed8-9fa3-8604758f20e0.png",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("反向代理的作用：")])]),s._v(" "),n("p",[s._v("（1）保证内网的安全，通常将反向代理作为公网访问地址，Web服务器是内网。")]),s._v(" "),n("p",[s._v("（2）负载均衡，通过反向代理服务器来优化网站的负载")]),s._v(" "),n("h2",{attrs:{id:"_1-3-正向代理与反向代理的应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-正向代理与反向代理的应用场景"}},[s._v("#")]),s._v(" 1.3 正向代理与反向代理的应用场景")]),s._v(" "),n("p",[s._v("通常情况下，我们在实际项目操作时，正向代理和反向代理很有可能会存在在一个应用场景中，**正向代理代理客户端的请求去访问目标服务器，目标服务器是一个反向代理服务器，反向代理了多台真实的业务处理服务器。**具体的拓扑图如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035276-64a46660-e97c-4186-aba2-c9d533a28a87.png",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"_1-4-正向代理与反向代理的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-正向代理与反向代理的区别"}},[s._v("#")]),s._v(" 1.4 正向代理与反向代理的区别")]),s._v(" "),n("p",[s._v("通过一张图来说明正向代理和反向代理二者之间的区别：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035284-7676d4e1-1895-4435-b3a2-3ab1c9195c7d.png",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("图解：")])]),s._v(" "),n("p",[s._v("在正向代理中，Proxy和Client同属于一个LAN（图中方框内），隐藏了客户端信息；")]),s._v(" "),n("p",[s._v("在反向代理中，Proxy和Server同属于一个LAN（图中方框内），隐藏了服务端信息；")]),s._v(" "),n("p",[s._v("实际上，Proxy在两种代理中做的事情都是替服务器代为收发请求和响应，不过从结构上看正好左右互换了一下，所以把后出现的那种代理方式称为反向代理了。")]),s._v(" "),n("h2",{attrs:{id:"_1-5-负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-负载均衡"}},[s._v("#")]),s._v(" 1.5 负载均衡")]),s._v(" "),n("p",[s._v("我们已经明确了所谓代理服务器的概念，那么接下来，"),n("strong",[s._v("Nginx扮演了反向代理服务器的角色")]),s._v("，它是以依据什么样的规则进行请求分发的呢？不用的项目应用场景，分发的规则是否可以控制呢？")]),s._v(" "),n("p",[s._v("我们把客户端发送的、Nginx反向代理服务器接收到的请求数量，就是我们说的负载量。")]),s._v(" "),n("p",[s._v("请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则。")]),s._v(" "),n("p",[s._v("将服务器接收到的请求按照规则分发的过程，称为负载均衡。")]),s._v(" "),n("p",[s._v("负载均衡在实际项目操作过程中，有"),n("strong",[s._v("硬件负载均衡和软件负载均衡")]),s._v("两种，硬件负载均衡也称为硬负载，如F5负载均衡，相对造价昂贵成本较高，但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035715-45ff166b-1cd0-497c-92f2-43fc237fed5f.png",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("Nginx支持的负载均衡调度算法方式如下：")])]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("weight轮询")]),s._v("（默认，常用，具有HA功效！）：接收到的请求按照权重分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。")]),s._v(" "),n("li",[n("strong",[s._v("ip_hash")]),s._v("（常用）：每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，这也在一定程度上解决了集群部署环境下"),n("strong",[s._v("session共享")]),s._v("的问题。")]),s._v(" "),n("li",[n("strong",[s._v("fair")]),s._v("：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是Nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块。")]),s._v(" "),n("li",[n("strong",[s._v("url_hash")]),s._v("：按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，可以在Nginx作为静态服务器的情况下提高缓存效率。同样要注意Nginx默认不支持这种调度算法，要使用的话需要安装Nginx的hash软件包。")])]),s._v(" "),n("h2",{attrs:{id:"_1-6-动静分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-动静分离"}},[s._v("#")]),s._v(" 1.6 动静分离")]),s._v(" "),n("p",[s._v("​\t\t为了提高网站的响应速度，减轻程序服务器（Tomcat，Jboss等）的负载，**对于静态资源比如图片，js，css等文件，我们可以在Nginx反向代理服务器中进行缓存，这样浏览器在请求一个静态资源时，Nginx代理服务器就可以直接处理，而不用将请求转发给后端服务器。**用户请求的动态文件比如servlet,jsp则转发给Tomcat，Jboss服务器处理，这就是动静分离。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035199-3b5a8b4d-d447-4de8-a9f8-5ad24efd64be.png",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"_1-7-几种常用web服务器对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-几种常用web服务器对比"}},[s._v("#")]),s._v(" 1.7 几种常用web服务器对比")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[s._v("对比项\\服务器")])]),s._v(" "),n("th",[n("strong",[s._v("Apache")])]),s._v(" "),n("th",[n("strong",[s._v("Nginx")])]),s._v(" "),n("th",[n("strong",[s._v("Lighttpd")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("Proxy代理")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("一般")])]),s._v(" "),n("tr",[n("td",[s._v("Rewriter")]),s._v(" "),n("td",[s._v("好")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("一般")])]),s._v(" "),n("tr",[n("td",[s._v("Fcgi")]),s._v(" "),n("td",[s._v("不好")]),s._v(" "),n("td",[s._v("好")]),s._v(" "),n("td",[s._v("非常好")])]),s._v(" "),n("tr",[n("td",[s._v("热部署")]),s._v(" "),n("td",[s._v("不支持")]),s._v(" "),n("td",[s._v("支持")]),s._v(" "),n("td",[s._v("不支持")])]),s._v(" "),n("tr",[n("td",[s._v("系统压力")]),s._v(" "),n("td",[s._v("很大")]),s._v(" "),n("td",[s._v("很小")]),s._v(" "),n("td",[s._v("比较小")])]),s._v(" "),n("tr",[n("td",[s._v("稳定性")]),s._v(" "),n("td",[s._v("好")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("不好")])]),s._v(" "),n("tr",[n("td",[s._v("安全性")]),s._v(" "),n("td",[s._v("好")]),s._v(" "),n("td",[s._v("一般")]),s._v(" "),n("td",[s._v("一般")])]),s._v(" "),n("tr",[n("td",[s._v("静态文件处理")]),s._v(" "),n("td",[s._v("一般")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("好")])]),s._v(" "),n("tr",[n("td",[s._v("反向代理")]),s._v(" "),n("td",[s._v("一般")]),s._v(" "),n("td",[s._v("非常好")]),s._v(" "),n("td",[s._v("一般")])])])]),s._v(" "),n("h1",{attrs:{id:"_2-linux安装nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-linux安装nginx"}},[s._v("#")]),s._v(" 2. Linux安装Nginx")]),s._v(" "),n("p",[s._v("关于Nginx的依赖说明：https://www.jianshu.com/p/14c81fbcb401")]),s._v(" "),n("p",[s._v("第一步安装pcre，下载网址：https://sourceforge.net/projects/pcre/files/pcre/8.44/")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/opt/nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://sourceforge.net/projects/pcre/files/pcre/8.44/pcre-8.44.tar.gz/download")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2290719")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 04:15 download\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf download ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2090750")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" download\ndrwxr-xr-x. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" pcre-8.44\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd pcre-8.44/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 pcre-8.44"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译安装 pcre-8.44")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 pcre-8.44"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make && make install")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pcre 安装成功后，查看其版本号")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 pcre-8.44"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pcre-config --version")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.44")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("第二步安装其它依赖："),n("code",[s._v("yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 yum.repos.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel")]),s._v("\n已加载插件：fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n软件包 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":make-3.82-24.el7.x86_64 已安装并且是最新版本\n软件包 zlib-1.2.7-19.el7_9.x86_64 已安装并且是最新版本\n软件包 zlib-devel-1.2.7-19.el7_9.x86_64 已安装并且是最新版本\n软件包 gcc-c++-4.8.5-44.el7.x86_64 已安装并且是最新版本\n软件包 libtool-2.4.2-22.el7_3.x86_64 已安装并且是最新版本\n软件包 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":openssl-1.0.2k-21.el7_9.x86_64 已安装并且是最新版本\n软件包 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":openssl-devel-1.0.2k-21.el7_9.x86_64 已安装并且是最新版本\n无须任何处理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("第三部安装Nginx，下载地址：https://nginx.org/en/download.html")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://nginx.org/download/nginx-1.18.0.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3072")]),s._v("\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2090750")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" download\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1039530")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" nginx-1.18.0.tar.gz\ndrwxr-xr-x. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12288")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":39 pcre-8.44\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf nginx-1.18.0.tar.gz ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3076")]),s._v("\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2090750")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" download\ndrwxr-xr-x. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" nginx-1.18.0\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1039530")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" nginx-1.18.0.tar.gz\ndrwxr-xr-x. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1169")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12288")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":39 pcre-8.44\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd nginx-1.18.0/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 nginx-1.18.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装成功之后，在/usr下多出来一个文件夹local/nginx，在/usr/local/nginx/sbin有启动脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/usr/local/nginx/sbin\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3764")]),s._v("\n-rwxr-xr-x. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3852280")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef |grep nginx")]),s._v("\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60890")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":05 ?        00:00:00 nginx: master process ./nginx\nnobody    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60892")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60890")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":05 ?        00:00:00 nginx: worker process\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60907")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127532")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":05 pts/3    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试Nginx是否成功，查看ip，然后网址输入ip地址可转到一个Nginx测试网页，这里只展示部分命令结果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig")]),s._v("\nens33: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.128  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.255\n        inet6 fe80::9eb2:b749:c806:4c97  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        ether 00:0c:29:61:23:1e  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("507925")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("738941851")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("704.7")]),s._v(" MiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("158188")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10510448")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(" MiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于我的Linxu虚拟机80端口未开，所以需要对防火墙进行配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --list-all")]),s._v("\npublic "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  target: default\n  icmp-block-inversion: no\n  interfaces: ens33\n  sources: \n  services: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" dhcpv6-client\n  ports: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp\n  protocols: \n  masquerade: no\n  forward-ports: \n  source-ports: \n  icmp-blocks: \n  rich rules: \n\t\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --permanent --add-port=80/tcp")]),s._v("\nsuccess\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --reload")]),s._v("\nsuccess\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --query-port=80/tcp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --list-all")]),s._v("\npublic "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  target: default\n  icmp-block-inversion: no\n  interfaces: ens33\n  sources: \n  services: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" dhcpv6-client\n  ports: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp\n  protocols: \n  masquerade: no\n  forward-ports: \n  source-ports: \n  icmp-blocks: \n  rich rules:\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035207-8af362fd-1355-46c2-ab78-4406f151b90f.png",alt:"img"}})]),s._v(" "),n("h1",{attrs:{id:"_3-nginx常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-nginx常用命令"}},[s._v("#")]),s._v(" 3. Nginx常用命令")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看nginx版本信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx -v ")]),s._v("\nnginx version: nginx/1.18.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef |grep nginx")]),s._v("\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62288")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 ?        00:00:00 nginx: master process ./nginx\nnobody    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62290")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62288")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 ?        00:00:00 nginx: worker process\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62325")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127532")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 pts/3    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx -s stop")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef |grep nginx")]),s._v("\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62346")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127532")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 pts/3    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载nginx，前提是nginx已启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx -s reload")]),s._v("\nnginx: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" open"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/logs/nginx.pid"')]),s._v(" failed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef |grep nginx")]),s._v("\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62428")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 ?        00:00:00 nginx: master process ./nginx\nnobody    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62430")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62428")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 ?        00:00:00 nginx: worker process\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62442")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127532")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 pts/3    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载nginx，前提是nginx已启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx -s reload")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef |grep nginx")]),s._v("\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62428")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 ?        00:00:00 nginx: master process ./nginx\nnobody    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62453")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62428")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 ?        00:00:00 nginx: worker process\nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("62465")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127532")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":19 pts/3    00:00:00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h1",{attrs:{id:"_4-nginx配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-nginx配置文件"}},[s._v("#")]),s._v(" 4. Nginx配置文件")]),s._v(" "),n("p",[s._v("配置文件的位置：/usr/local/nginx/conf/nginx.conf")]),s._v(" "),n("p",[n("strong",[s._v("nginx.conf分为三个模块：全局块、events块、http块")])]),s._v(" "),n("h2",{attrs:{id:"_4-1-全局块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-全局块"}},[s._v("#")]),s._v(" 4.1 全局块")]),s._v(" "),n("p",[s._v("全局块：从配置文件开始到 events 块之间的内容，主要会设置一些影响 Nginx 服务器整体运行的配置指令，配置服务器整体运行的配置指令。")]),s._v(" "),n("p",[n("strong",[s._v("主要包括：")])]),s._v(" "),n("p",[s._v("1、配置运行 Nginx 服务器的用户（组）、")]),s._v(" "),n("p",[s._v("2、允许生成的 worker process 数，")]),s._v(" "),n("p",[s._v("3、进程 PID 存放路径、")]),s._v(" "),n("p",[s._v("4、日志存放路径和类型")]),s._v(" "),n("p",[s._v("5、配置文件的引入")]),s._v(" "),n("p",[s._v("6、…")]),s._v(" "),n("h2",{attrs:{id:"_4-2-events块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-events块"}},[s._v("#")]),s._v(" 4.2 events块")]),s._v(" "),n("p",[s._v("events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接，常用的设置包括是否开启对多 work process 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 work process 可以同时支持的最大连接数等。")]),s._v(" "),n("h2",{attrs:{id:"_4-3-http块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-http块"}},[s._v("#")]),s._v(" 4.3 http块")]),s._v(" "),n("p",[s._v("http块是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。")]),s._v(" "),n("p",[n("strong",[s._v("需要注意的是，http 块也可以包括:")])]),s._v(" "),n("ul",[n("li",[s._v("http 全局块")]),s._v(" "),n("li",[s._v("多个server 块")])]),s._v(" "),n("h3",{attrs:{id:"_4-3-1-http-全局块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-http-全局块"}},[s._v("#")]),s._v(" 4.3.1 http 全局块")]),s._v(" "),n("p",[s._v("http 全局块配置的指令包括文件引入、 MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等")]),s._v(" "),n("h3",{attrs:{id:"_4-3-2-server-块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-server-块"}},[s._v("#")]),s._v(" 4.3.2 server 块")]),s._v(" "),n("p",[s._v("这块和虚拟主机有密切关系，虚拟主机从用户角度看，和单一独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。")]),s._v(" "),n("p",[s._v("每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。")]),s._v(" "),n("p",[n("strong",[s._v("而每个 server 块也分为：")])]),s._v(" "),n("ul",[n("li",[s._v("全局 server 块")]),s._v(" "),n("li",[s._v("多个 locaton 块")])]),s._v(" "),n("h4",{attrs:{id:"_4-3-2-1-全局-server-块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-1-全局-server-块"}},[s._v("#")]),s._v(" 4.3.2.1 全局 server 块")]),s._v(" "),n("p",[s._v("最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。")]),s._v(" "),n("h4",{attrs:{id:"_4-3-2-2-location-块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-2-location-块"}},[s._v("#")]),s._v(" 4.3.2.2 location 块")]),s._v(" "),n("p",[s._v("一个 server 块可以配置多个 location 块。")]),s._v(" "),n("p",[s._v("这块的主要作用是基于 Nginx 服务器接收到的请求字符串（例如 server_name/uri-string），对虚拟主机名称（也可以是 IP 别名）之外的字符串（例如： /uri-string）进行匹配，对特定的请求进行处理。")]),s._v(" "),n("h2",{attrs:{id:"_4-4-配置文件的内容解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-配置文件的内容解析"}},[s._v("#")]),s._v(" 4.4 配置文件的内容解析")]),s._v(" "),n("p",[s._v("更多内容可参考：")]),s._v(" "),n("p",[s._v("https://blog.csdn.net/wangbin_0729/article/details/82109693")]),s._v(" "),n("p",[s._v("https://www.cnblogs.com/hunttown/p/5759959.html")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义Nginx运行的用户和用户组")]),s._v("\nuser www www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定了Nginx要开启的进程数。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个Nginx进程平均耗费10M~12M内存。建议指定和CPU的数量一致即可。")]),s._v("\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其中，debug输出日志最为最详细，而crit输出日志最少。")]),s._v("\nerror_log /usr/local/nginx/logs/error.log info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定进程pid的存储文件位置")]),s._v("\npid /usr/local/nginx/logs/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定进程可以打开的最大描述符：数目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#工作模式与连接数上限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个指令是指当一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（ulimit -n）与nginx进程数相除，但是nginx分配请求并不是那么均匀，所以最好与ulimit -n 的值保持一致。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#现在在linux 2.6内核下开启文件打开数为65535，worker_rlimit_nofile就相应应该填写65535。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这是因为nginx调度时分配请求到进程并不是那么的均衡，所以假如填写10240，总并发量达到3-4万时就有进程可能超过10240了，这时会返回502错误。")]),s._v("\nworker_rlimit_nofile "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# events事件指令是设定Nginx的工作模式及连接数上限：")]),s._v("\nevents\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#events事件指令是设定Nginx的工作模式及连接数上限：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#use是个事件模块指令，用来指定Nginx的工作模式。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和/dev/poll。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对于Linux系统，epoll工作模式是首选。")]),s._v("\n    use epoll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#worker_connections也是个事件模块指令，用于定义Nginx每个进程的最大连接数，默认是1024。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最大客户端连接数由worker_processes和worker_connections决定，即Max_clients=worker_processes*worker_connections。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在作为反向代理时，max_clients变为：max_clients = worker_processes * worker_connections/4。")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进程的最大连接数受Linux系统进程的最大打开文件数限制，在执行操作系统命令“ulimit -n 65536”后worker_connections的设置才能生效")]),s._v("\n    worker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive超时时间。")]),s._v("\n    keepalive_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户端请求头部的缓冲区大小。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分页大小可以用命令getconf PAGESIZE 取得。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#[root@web001 ~]# getconf PAGESIZE")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4096")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#但也有client_header_buffer_size超过4k的情况，但是client_header_buffer_size该值必须设置为“系统分页大小”的整倍数。")]),s._v("\n    client_header_buffer_size 4k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量，建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存。")]),s._v("\n    open_file_cache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inactive")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("60s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个是指多长时间检查一次缓存的有效信息。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#语法:open_file_cache_valid time 默认值:open_file_cache_valid 60 使用字段:http, server, location 这个指令指定了何时需要检查open_file_cache中缓存项目的有效信息.")]),s._v("\n    open_file_cache_valid 80s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将被移除。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#语法:open_file_cache_min_uses number 默认值:open_file_cache_min_uses 1 使用字段:http, server, location  这个指令指定了在open_file_cache指令无效的参数中一定的时间范围内可以使用的最小文件数,如果使用更大的值,文件描述符在cache中总是打开状态.")]),s._v("\n    open_file_cache_min_uses "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#语法:open_file_cache_errors on | off 默认值:open_file_cache_errors off 使用字段:http, server, location 这个指令指定是否在搜索一个文件是记录cache错误.")]),s._v("\n    open_file_cache_errors on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n \n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定http服务器，利用它的反向代理功能提供负载均衡支持")]),s._v("\nhttp\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实现对配置文件所包含的文件的设定，可以减少主配置文件的复杂度。类似于Apache中的include方法。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件扩展名与文件类型映射表")]),s._v("\n    include mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认文件类型")]),s._v("\n    default_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认编码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset utf-8;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务器名字的hash表大小")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存服务器名字的hash表是由指令server_names_hash_max_size 和server_names_hash_bucket_size所控制的。参数hash bucket size总是等于hash表的大小，并且是一路处理器缓存大小的倍数。在减少了在内存中的存取次数后，使在处理器中加速查找hash表键值成为可能。如果hash bucket size等于一路处理器缓存的大小，那么在查找键的时候，最坏的情况下在内存中查找的次数为2。第一次是确定存储单元的地址，第二次是在存储单元中查找键 值。因此，如果Nginx给出需要增大hash max size 或 hash bucket size的提示，那么首要的是增大前一个参数的大小.")]),s._v("\n    server_names_hash_bucket_size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求的头部大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。")]),s._v("\n    client_header_buffer_size 32k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户请求头缓冲大小。nginx默认会用client_header_buffer_size这个buffer来读取header值，如果header过大，它会使用large_client_header_buffers来读取。")]),s._v("\n    large_client_header_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定通过nginx上传文件的大小")]),s._v("\n    client_max_body_size 8m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendfile指令指定 nginx 是否调用sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为on。如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络IO处理速度，降低系统uptime。")]),s._v("\n    sendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启目录列表访问，合适下载服务器，默认关闭。")]),s._v("\n    autoindex on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此选项允许或禁止使用socke的TCP_CORK的选项，此选项仅在使用sendfile的时候使用")]),s._v("\n    tcp_nopush on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     \n    tcp_nodelay on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#长连接超时时间，单位是秒")]),s._v("\n    keepalive_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。")]),s._v("\n    fastcgi_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_send_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_read_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffer_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_busy_buffers_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fastcgi_temp_file_write_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip模块设置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启gzip压缩输出")]),s._v("\n    gzip_min_length 1k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小压缩文件大小")]),s._v("\n    gzip_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 16k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩缓冲区")]),s._v("\n    gzip_http_version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩版本（默认1.1，前端如果是squid2.5请使用1.0）")]),s._v("\n    gzip_comp_level "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩等级")]),s._v("\n    gzip_types text/plain application/x-javascript text/css application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩类型，默认就已经包含textml，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。")]),s._v("\n    gzip_vary on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启限制IP连接数的时候需要使用")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#limit_zone crawler $binary_remote_addr 10m;")]),s._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#负载均衡配置")]),s._v("\n    upstream piao.jd.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.121:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.122:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".80.123:80 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx的upstream目前支持4种方式的分配")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、轮询（默认）")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、weight")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例如：")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream bakend {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 192.168.0.14 weight=10;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 192.168.0.15 weight=10;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、ip_hash")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例如：")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream bakend {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ip_hash;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 192.168.0.14:88;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 192.168.0.15:80;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、fair（第三方）")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按后端服务器的响应时间来分配请求，响应时间短的优先分配。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream backend {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server server1;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server server2;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fair;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4、url_hash（第三方）")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream backend {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server squid1:3128;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server squid2:3128;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    hash $request_uri;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    hash_method crc32;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tips:")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream bakend{#定义负载均衡设备的Ip及设备状态}{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ip_hash;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 127.0.0.1:9090 down;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 127.0.0.1:8080 weight=2;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 127.0.0.1:6060;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server 127.0.0.1:7070 backup;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在需要使用负载均衡的server中增加 proxy_pass http://bakend/;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个设备的状态设置为:")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.down表示单前的server暂时不参与负载")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.weight为weight越大，负载的权重就越大。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.max_fails：允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream模块定义的错误")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4.fail_timeout:max_fails次失败后，暂停的时间。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5.backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx支持同时设置多组的负载均衡，用来给不用的server来使用。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#client_body_in_file_only设置为On 可以讲client post过来的数据记录到文件中用来做debug")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#client_body_temp_path设置记录文件的目录 可以设置最多3层目录")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location对URL进行匹配.可以进行重定向或者进行新的代理 负载均衡")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     \n     \n     \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟主机的配置")]),s._v("\n    server\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监听端口")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#域名可以有多个，用空格隔开")]),s._v("\n        server_name www.jd.com jd.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index index.html index.htm index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        root /data/www/jd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对******进行负载均衡")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("php"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("php5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            fastcgi_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fastcgi_index index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            include fastcgi.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#图片缓存时间设置")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 10d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#JS和CSS缓存时间设置")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 1h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志格式设定")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$remote_user：用来记录客户端用户名称；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$time_local： 用来记录访问时间与时区；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$request： 用来记录请求的url与http协议；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$status： 用来记录请求状态；成功是200，")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$body_bytes_sent ：记录发送给客户端文件主体内容大小；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$http_referer：用来记录从那个页面链接访问过来的；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$http_user_agent：记录客户浏览器的相关信息；")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记录原有客户端的IP地址和原来客户端的请求的服务器地址。")]),s._v("\n        log_format access "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"$http_user_agent\" $http_x_forwarded_for'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义本虚拟主机的访问日志")]),s._v("\n        access_log  /usr/local/nginx/logs/host.access.log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        access_log  /usr/local/nginx/logs/host.access.404.log  log404"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#对 "/" 启用反向代理')]),s._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_pass http://127.0.0.1:88"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_redirect off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n             \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP")]),s._v("\n            proxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n             \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#以下是一些反向代理的配置，可选。")]),s._v("\n            proxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许客户端请求的最大单文件字节数")]),s._v("\n            client_max_body_size 10m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓冲区代理缓冲用户端请求的最大字节数，")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果把它设置为比较大的数值，例如256k，那么，无论使用firefox还是IE浏览器，来提交任意小于256k的图片，都很正常。如果注释该指令，使用默认的client_body_buffer_size设置，也就是操作系统页面大小的两倍，8k或者16k，问题就出现了。")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#无论使用firefox4.0还是IE8.0，提交一个比较大，200k左右的图片，都返回500 Internal Server Error错误")]),s._v("\n            client_body_buffer_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示使nginx阻止HTTP应答代码为400或者更高的应答。")]),s._v("\n            proxy_intercept_errors on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端服务器连接的超时时间_发起握手等候响应超时时间")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx跟后端服务器连接超时时间(代理连接超时)")]),s._v("\n            proxy_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端服务器数据回传时间(代理发送超时)")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后端服务器数据回传时间_就是在规定时间之内后端服务器必须传完所有的数据")]),s._v("\n            proxy_send_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接成功后，后端服务器响应时间(代理接收超时)")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理（也可以说是后端服务器处理请求的时间）")]),s._v("\n            proxy_read_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置代理服务器（nginx）保存用户头信息的缓冲区大小")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置从被代理服务器读取的第一部分应答的缓冲区大小，通常情况下这部分应答中包含一个小的应答头，默认情况下这个值的大小为指令proxy_buffers中指定的一个缓冲区的大小，不过可以将其设置为更小")]),s._v("\n            proxy_buffer_size 4k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_buffers缓冲区，网页平均在32k以下的设置")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置用于读取应答（来自被代理服务器）的缓冲区数目和大小，默认情况也为分页大小，根据操作系统的不同可能是4k或者8k")]),s._v("\n            proxy_buffers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 32k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#高负荷下缓冲大小（proxy_buffers*2）")]),s._v("\n            proxy_busy_buffers_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置在写入proxy_temp_path时数据的大小，预防一个工作进程在传递文件时阻塞太长")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定缓存文件夹大小，大于这个值，将从upstream服务器传")]),s._v("\n            proxy_temp_file_write_size 64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定查看Nginx状态的地址")]),s._v("\n        location /NginxStatus "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            stub_status on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            access_log on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            auth_basic "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NginxStatus"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            auth_basic_user_file confpasswd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#htpasswd文件的内容可以用apache提供的htpasswd工具来产生。")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本地动静分离反向代理配置")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有jsp的页面均交由tomcat或resin处理")]),s._v("\n        location ~ ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jsp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jspx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://127.0.0.1:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有静态文件由nginx直接读取不经过tomcat或resin")]),s._v("\n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ioc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rar")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("txt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("flv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("doc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ppt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        pdf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xls"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mp3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wma"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 15d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         \n        location ~ .*."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 1h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br"),n("span",{staticClass:"line-number"},[s._v("208")]),n("br"),n("span",{staticClass:"line-number"},[s._v("209")]),n("br"),n("span",{staticClass:"line-number"},[s._v("210")]),n("br"),n("span",{staticClass:"line-number"},[s._v("211")]),n("br"),n("span",{staticClass:"line-number"},[s._v("212")]),n("br"),n("span",{staticClass:"line-number"},[s._v("213")]),n("br"),n("span",{staticClass:"line-number"},[s._v("214")]),n("br"),n("span",{staticClass:"line-number"},[s._v("215")]),n("br"),n("span",{staticClass:"line-number"},[s._v("216")]),n("br"),n("span",{staticClass:"line-number"},[s._v("217")]),n("br"),n("span",{staticClass:"line-number"},[s._v("218")]),n("br"),n("span",{staticClass:"line-number"},[s._v("219")]),n("br"),n("span",{staticClass:"line-number"},[s._v("220")]),n("br"),n("span",{staticClass:"line-number"},[s._v("221")]),n("br"),n("span",{staticClass:"line-number"},[s._v("222")]),n("br"),n("span",{staticClass:"line-number"},[s._v("223")]),n("br"),n("span",{staticClass:"line-number"},[s._v("224")]),n("br"),n("span",{staticClass:"line-number"},[s._v("225")]),n("br"),n("span",{staticClass:"line-number"},[s._v("226")]),n("br"),n("span",{staticClass:"line-number"},[s._v("227")]),n("br"),n("span",{staticClass:"line-number"},[s._v("228")]),n("br"),n("span",{staticClass:"line-number"},[s._v("229")]),n("br"),n("span",{staticClass:"line-number"},[s._v("230")]),n("br"),n("span",{staticClass:"line-number"},[s._v("231")]),n("br"),n("span",{staticClass:"line-number"},[s._v("232")]),n("br"),n("span",{staticClass:"line-number"},[s._v("233")]),n("br"),n("span",{staticClass:"line-number"},[s._v("234")]),n("br"),n("span",{staticClass:"line-number"},[s._v("235")]),n("br"),n("span",{staticClass:"line-number"},[s._v("236")]),n("br"),n("span",{staticClass:"line-number"},[s._v("237")]),n("br"),n("span",{staticClass:"line-number"},[s._v("238")]),n("br"),n("span",{staticClass:"line-number"},[s._v("239")]),n("br"),n("span",{staticClass:"line-number"},[s._v("240")]),n("br"),n("span",{staticClass:"line-number"},[s._v("241")]),n("br"),n("span",{staticClass:"line-number"},[s._v("242")]),n("br"),n("span",{staticClass:"line-number"},[s._v("243")]),n("br"),n("span",{staticClass:"line-number"},[s._v("244")]),n("br"),n("span",{staticClass:"line-number"},[s._v("245")]),n("br"),n("span",{staticClass:"line-number"},[s._v("246")]),n("br"),n("span",{staticClass:"line-number"},[s._v("247")]),n("br"),n("span",{staticClass:"line-number"},[s._v("248")]),n("br"),n("span",{staticClass:"line-number"},[s._v("249")]),n("br"),n("span",{staticClass:"line-number"},[s._v("250")]),n("br"),n("span",{staticClass:"line-number"},[s._v("251")]),n("br"),n("span",{staticClass:"line-number"},[s._v("252")]),n("br"),n("span",{staticClass:"line-number"},[s._v("253")]),n("br"),n("span",{staticClass:"line-number"},[s._v("254")]),n("br"),n("span",{staticClass:"line-number"},[s._v("255")]),n("br"),n("span",{staticClass:"line-number"},[s._v("256")]),n("br"),n("span",{staticClass:"line-number"},[s._v("257")]),n("br"),n("span",{staticClass:"line-number"},[s._v("258")]),n("br"),n("span",{staticClass:"line-number"},[s._v("259")]),n("br"),n("span",{staticClass:"line-number"},[s._v("260")]),n("br"),n("span",{staticClass:"line-number"},[s._v("261")]),n("br"),n("span",{staticClass:"line-number"},[s._v("262")]),n("br"),n("span",{staticClass:"line-number"},[s._v("263")]),n("br"),n("span",{staticClass:"line-number"},[s._v("264")]),n("br"),n("span",{staticClass:"line-number"},[s._v("265")]),n("br"),n("span",{staticClass:"line-number"},[s._v("266")]),n("br"),n("span",{staticClass:"line-number"},[s._v("267")]),n("br"),n("span",{staticClass:"line-number"},[s._v("268")]),n("br"),n("span",{staticClass:"line-number"},[s._v("269")]),n("br"),n("span",{staticClass:"line-number"},[s._v("270")]),n("br"),n("span",{staticClass:"line-number"},[s._v("271")]),n("br"),n("span",{staticClass:"line-number"},[s._v("272")]),n("br"),n("span",{staticClass:"line-number"},[s._v("273")]),n("br"),n("span",{staticClass:"line-number"},[s._v("274")]),n("br"),n("span",{staticClass:"line-number"},[s._v("275")]),n("br"),n("span",{staticClass:"line-number"},[s._v("276")]),n("br"),n("span",{staticClass:"line-number"},[s._v("277")]),n("br"),n("span",{staticClass:"line-number"},[s._v("278")]),n("br"),n("span",{staticClass:"line-number"},[s._v("279")]),n("br"),n("span",{staticClass:"line-number"},[s._v("280")]),n("br"),n("span",{staticClass:"line-number"},[s._v("281")]),n("br"),n("span",{staticClass:"line-number"},[s._v("282")]),n("br"),n("span",{staticClass:"line-number"},[s._v("283")]),n("br"),n("span",{staticClass:"line-number"},[s._v("284")]),n("br"),n("span",{staticClass:"line-number"},[s._v("285")]),n("br"),n("span",{staticClass:"line-number"},[s._v("286")]),n("br"),n("span",{staticClass:"line-number"},[s._v("287")]),n("br"),n("span",{staticClass:"line-number"},[s._v("288")]),n("br"),n("span",{staticClass:"line-number"},[s._v("289")]),n("br"),n("span",{staticClass:"line-number"},[s._v("290")]),n("br"),n("span",{staticClass:"line-number"},[s._v("291")]),n("br"),n("span",{staticClass:"line-number"},[s._v("292")]),n("br"),n("span",{staticClass:"line-number"},[s._v("293")]),n("br"),n("span",{staticClass:"line-number"},[s._v("294")]),n("br"),n("span",{staticClass:"line-number"},[s._v("295")]),n("br"),n("span",{staticClass:"line-number"},[s._v("296")]),n("br"),n("span",{staticClass:"line-number"},[s._v("297")]),n("br"),n("span",{staticClass:"line-number"},[s._v("298")]),n("br"),n("span",{staticClass:"line-number"},[s._v("299")]),n("br"),n("span",{staticClass:"line-number"},[s._v("300")]),n("br"),n("span",{staticClass:"line-number"},[s._v("301")]),n("br"),n("span",{staticClass:"line-number"},[s._v("302")]),n("br"),n("span",{staticClass:"line-number"},[s._v("303")]),n("br"),n("span",{staticClass:"line-number"},[s._v("304")]),n("br"),n("span",{staticClass:"line-number"},[s._v("305")]),n("br"),n("span",{staticClass:"line-number"},[s._v("306")]),n("br"),n("span",{staticClass:"line-number"},[s._v("307")]),n("br"),n("span",{staticClass:"line-number"},[s._v("308")]),n("br"),n("span",{staticClass:"line-number"},[s._v("309")]),n("br"),n("span",{staticClass:"line-number"},[s._v("310")]),n("br"),n("span",{staticClass:"line-number"},[s._v("311")]),n("br"),n("span",{staticClass:"line-number"},[s._v("312")]),n("br"),n("span",{staticClass:"line-number"},[s._v("313")]),n("br"),n("span",{staticClass:"line-number"},[s._v("314")]),n("br"),n("span",{staticClass:"line-number"},[s._v("315")]),n("br"),n("span",{staticClass:"line-number"},[s._v("316")]),n("br"),n("span",{staticClass:"line-number"},[s._v("317")]),n("br"),n("span",{staticClass:"line-number"},[s._v("318")]),n("br"),n("span",{staticClass:"line-number"},[s._v("319")]),n("br"),n("span",{staticClass:"line-number"},[s._v("320")]),n("br"),n("span",{staticClass:"line-number"},[s._v("321")]),n("br"),n("span",{staticClass:"line-number"},[s._v("322")]),n("br"),n("span",{staticClass:"line-number"},[s._v("323")]),n("br"),n("span",{staticClass:"line-number"},[s._v("324")]),n("br"),n("span",{staticClass:"line-number"},[s._v("325")]),n("br"),n("span",{staticClass:"line-number"},[s._v("326")]),n("br"),n("span",{staticClass:"line-number"},[s._v("327")]),n("br"),n("span",{staticClass:"line-number"},[s._v("328")]),n("br")])]),n("h1",{attrs:{id:"_5-配置反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置反向代理"}},[s._v("#")]),s._v(" 5. 配置反向代理")]),s._v(" "),n("h2",{attrs:{id:"_5-1-案例一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-案例一"}},[s._v("#")]),s._v(" 5.1 案例一")]),s._v(" "),n("p",[s._v("案例效果：打开浏览器，在浏览器地址栏输入地址 www.123.com ，跳转到 liunx 系统 tomcat 主页面中")]),s._v(" "),n("p",[s._v("前面我们已经了解了反向代理是代理后端服务器的，我们以一张图再回顾一下，这张图也是此案例配置的示例图！")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035276-28df9d32-9867-471f-853e-353057c3b421.png",alt:"img"}})]),s._v(" "),n("p",[s._v("从图中我们可以看出，我们还需要配置tomcat，安装tomcat可参考：https://www.yuque.com/bithachi/study/ko2vq0 的第5个内容。")]),s._v(" "),n("p",[s._v("并且Nginx开放80端口，可参考上面的安装Nginx部分配置端口。")]),s._v(" "),n("p",[s._v("我们将图上所述的配置好之后，启动nginx测试，windows浏览器访问www.123.com，Nginx反向代理服务器会将请求转发到tomcat默认测试的127.0.0.1：8080页面。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035290-9f6169e1-00c6-48b9-afd8-eb5024608eca.png",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"_5-2-案例二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-案例二"}},[s._v("#")]),s._v(" 5.2 案例二")]),s._v(" "),n("p",[s._v("实现效果：使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中nginx 监听端口为 9001")]),s._v(" "),n("p",[s._v("访问 http://192.168.14.128:9001/edu/ 直接跳转到 127.0.0.1:8080")]),s._v(" "),n("p",[s._v("访问 http:// 192.168.14.128:9001/vod/ 直接跳转到 127.0.0.1:8081")]),s._v(" "),n("p",[s._v("配置步骤：")]),s._v(" "),n("p",[s._v("（1 ）准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口")]),s._v(" "),n("p",[s._v("（2 ）创建文件夹edu和vod和测试页面a.html")]),s._v(" "),n("p",[s._v("（3 ）开放对外访问的端口号 9001 8080 8081")]),s._v(" "),n("p",[s._v("(4 ）修改nginx.conf")]),s._v(" "),n("p",[s._v("(5）测试访问")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035269-8abd6651-0cc3-40ff-acc2-d94e1c4dc6f2.png",alt:"img"}})]),s._v(" "),n("p",[s._v("nginx.conf中http块中的location块 配置说明：")]),s._v(" "),n("p",[s._v("location用于匹配 URL，语法如下：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" [ = | ~ | ~* | ^~ ] uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n= ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。\n~：用于表示 uri 包含正则表达式，并且区分大小写。\n~*：用于表示 uri 包含正则表达式，并且不区分大小写。\n^~：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location块中的正则 uri 和请求字符串做匹配。\n注意：如果uri包含正则表达式，则必须要有 ~ 或者 ~* 标识。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h1",{attrs:{id:"_6-配置负载均衡-轮询访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置负载均衡-轮询访问"}},[s._v("#")]),s._v(" 6. 配置负载均衡-轮询访问")]),s._v(" "),n("ol",[n("li",[s._v("实现效果：浏览器地址栏输入地址 http://192.168.17.129/edu/a.html ，负载均衡效果，轮询访问8080和  8081 端口")]),s._v(" "),n("li",[s._v("准备工作：\n（1 ）准备两台 tomcat 服务器，一台 8080 ，一台 8081\n（2 ）在两台 tomcat 里面 webapps 目录中，创建名称是 edu 文件夹，在 edu 文件夹中创建页面 a.html ，用于测试")]),s._v(" "),n("li",[s._v("在 nginx 的配置文件nginx.conf中进行负载均衡的配置")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035278-d3998ca4-332a-41f3-bc7a-a629e685345e.png",alt:"img"}})]),s._v(" "),n("p",[s._v("最后我们重启nginx，进行测试访问：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/gif/10385897/1614601035226-e5a046bc-c842-49ee-b43f-76e94c7fef9e.gif",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"_6-1-nginx负载均衡策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-nginx负载均衡策略"}},[s._v("#")]),s._v(" 6.1 Nginx负载均衡策略")]),s._v(" "),n("p",[s._v("负载均衡（load balance）即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应足够快，给用户很好的体验。")]),s._v(" "),n("p",[s._v("快速增长的访问量和数据流量催生了各式各样的负载均衡产品，很多专业的负载均衡硬件提供了很好的功能，但却价格不菲，这使得负载均衡软件大受欢迎，nginx 就是其中的一个，在 linux 下有 Nginx、 LVS、 Haproxy 等等服务可以提供负载均衡服务，而且 Nginx 提供了几种分配方式(策略)")]),s._v(" "),n("p",[n("strong",[s._v("①、轮询")])]),s._v(" "),n("p",[s._v("这是Ngnix负载均衡默认分配策略。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。")]),s._v(" "),n("p",[n("strong",[s._v("②、加权")])]),s._v(" "),n("p",[s._v("weight 代表权重，默认为 1，权重越高被分配的客户端越多。指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。例如：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8081 weight=8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080 weight=2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("③、ip_hash")])]),s._v(" "),n("p",[s._v("每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。 例如：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("④、fair（第三方）")])]),s._v(" "),n("p",[s._v("这是Ngnix负载均衡第三方分配策略。按后端服务器的响应时间来分配请求，响应时间短的优先分配。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fair")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h1",{attrs:{id:"_7-配置动静分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-配置动静分离"}},[s._v("#")]),s._v(" 7. 配置动静分离")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035299-003d5e58-0d45-47be-8cb7-e9fdeee97c6a.png",alt:"img"}})]),s._v(" "),n("p",[s._v("1.准备静态资源")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/opt/static\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree -a /opt/static/")]),s._v("\n/opt/static/\n├── html\n│   └── a.html\n└── image\n    └── a.jpg\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("2.配置/usr/local/nginx/conf/nginx.conf")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035307-4a1615eb-dcd9-400c-ad5a-4e296637d9b4.png",alt:"img"}})]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("        upstream HA-tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            server locahost:8082"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            server locahost:8085"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("        \n        \n        location ^~ /static/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root D:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("resource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location ~* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ico"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("txt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root D:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nginx-1.12.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http://HA-tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("3.重启nginx，windwos测试访问")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/usr/local/nginx/sbin\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos7601 sbin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx -s reload")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035247-cadcdad7-e0b9-421d-8bd1-bf87d9b479a9.png",alt:"img"}})]),s._v(" "),n("h1",{attrs:{id:"_8-配置高可用nginx集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-配置高可用nginx集群"}},[s._v("#")]),s._v(" 8. 配置高可用Nginx集群")]),s._v(" "),n("h2",{attrs:{id:"_8-1-nginx高可用部署图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-nginx高可用部署图"}},[s._v("#")]),s._v(" 8.1 Nginx高可用部署图")]),s._v(" "),n("p",[s._v("Nginx高可用简单原理图：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035744-388cdb1a-d471-4310-8724-dcc73647ec12.png",alt:"img"}})]),s._v(" "),n("p",[s._v("​\t"),n("strong",[s._v("Keepalived的作用是检测服务器的状态")]),s._v("，如果有一台web服务器宕机，或工作出现故障，Keepalived将检测到，并将有故障的服务器从系统中剔除，同时使用其他服务器代替该服务器的工作，当服务器工作正常后Keepalived自动将服务器加入到服务器群中，这些工作全部自动完成，不需要人工干涉，需要人工做的只是修复故障的服务器。")]),s._v(" "),n("h2",{attrs:{id:"_8-2-安装nginx和keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-安装nginx和keepalived"}},[s._v("#")]),s._v(" 8.2 安装Nginx和keepalived")]),s._v(" "),n("p",[s._v("下面我们来进行Nginx高可用集群配置，这里就搞两台Nginx集群，跟上图一样。")]),s._v(" "),n("ul",[n("li",[s._v("两台服务器都要安装Nginx、keepalived")]),s._v(" "),n("li",[s._v("两台nginx的nginx.conf内容都为默认安装时的内容")]),s._v(" "),n("li",[s._v("192.168.14.128作为Nginx主服务器")]),s._v(" "),n("li",[s._v("192.168.14.129作为Nginx从服务器")])]),s._v(" "),n("p",[n("strong",[s._v("第一步：安装Nginx，这一步可参考上文Nginx安装步骤。")])]),s._v(" "),n("p",[n("strong",[s._v("第二步：安装keepalived")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 yum 命令安装 keepalived")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" keepalived\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果提示安装失败，需要什么依赖，比如缺少依赖 libmysqlclient.so.18(64bit)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们可以使用find / -name libmysqlclient.so* 查询libmysqlclient.so，看看是不是确实缺少libmysqlclient.so.18")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果缺的话，就到mysql官网(https://downloads.mysql.com/archives/community/)下载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用wget https://downloads.mysql.com/archives/get/p/23/file/mysql-community-libs-compat-5.7.26-1.el7.x86_64.rpm进行下载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后安装：rpm -ivh rpm -ivh mysql-community-libs-compat-5.7.26-1.el7.x86_64.rpm ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后再试试安装keepalived")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" keepalived\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 rpm 命令查询 keepalived 的安装包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" keepalived\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果你的镜像mirror有问题，可以试试以下3个命令重新弄一下yum，再安装keepalived")]),s._v("\nyum clean all\nyum makecache\nyum update "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("keepalived的配置文件位置：/etc/keepalived/keepalivec.conf")]),s._v(" "),n("h2",{attrs:{id:"_8-3-nginx检测脚本文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-nginx检测脚本文件"}},[s._v("#")]),s._v(" 8.3 nginx检测脚本文件")]),s._v(" "),n("p",[s._v("两台Nginx都要设置nginx_check.sh检测文件，文件位置都在/usr/local/nginx目录下，nginx_check.sh脚本文件用于检测Nginx是否正常运行。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("A")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" nginx ¨Cno-header "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    /usr/local/nginx/sbin/nginx\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" nginx --no-header "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" keepalived\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"_8-4-配置keepalivec-conf配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-配置keepalivec-conf配置文件"}},[s._v("#")]),s._v(" 8.4 配置keepalivec.conf配置文件")]),s._v(" "),n("h3",{attrs:{id:"_1-master-192-168-14-128"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-master-192-168-14-128"}},[s._v("#")]),s._v(" （1）MASTER：192.168.14.128")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\n\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   notification_email "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.101\n   smtp_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n   router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_script chk_http_port "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/nginx_check.sh"')]),s._v(" \n\n    interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测脚本执行的间隔")]),s._v("\n\n    weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份服务器上将 MASTER 改为 BACKUP")]),s._v("\n    interface ens33          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机的 virtual_router_id 须相同")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机取不同的优先级，主机值较大，备机值较小")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.111      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VRRP H 虚拟地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h3",{attrs:{id:"_2-backup-192-168-14-129"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-backup-192-168-14-129"}},[s._v("#")]),s._v(" （2）BACKUP：192.168.14.129")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\n\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   notification_email "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.101\n   smtp_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n   router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_script chk_http_port "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/nginx/nginx_check.sh"')]),s._v(" \n\n    interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测脚本执行的间隔")]),s._v("\n\n    weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state BACKUP            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份服务器上将 MASTER 改为 BACKUP")]),s._v("\n    interface ens33          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机的 virtual_router_id 须相同")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机取不同的优先级，主机值较大，备机值较小")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".14.111      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VRRP H 虚拟地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h3",{attrs:{id:"_3-启动nginx和keepalived测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动nginx和keepalived测试"}},[s._v("#")]),s._v(" （3）启动nginx和keepalived测试")]),s._v(" "),n("p",[s._v("两台Nginx都启动nginx和keepalived进行测试")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("# 启动nginx\n./nginx \n# 启动keepalived\nsystemctl start keepalived.service\n# 测试访问nginx反向代理服务器是否被虚拟ip访问取代，用虚拟ip统一访问Nginx集群\nip a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035306-21a414dc-e5a2-4fb4-98d8-55cd64261eb0.png",alt:"img"}})]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/10385897/1614601035324-8a7dea75-7492-4ea7-81d1-173ff8fffab8.png",alt:"img"}})]),s._v(" "),n("h3",{attrs:{id:"_4-配置文件keepalivec-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置文件keepalivec-conf"}},[s._v("#")]),s._v(" （4）配置文件keepalivec.conf")]),s._v(" "),n("ul",[n("li",[s._v("https://blog.csdn.net/bbwangj/article/details/80345978")]),s._v(" "),n("li",[s._v("https://cloud.tencent.com/developer/article/1416596")])]),s._v(" "),n("h1",{attrs:{id:"_9-nginx原理解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-nginx原理解析"}},[s._v("#")]),s._v(" 9. Nginx原理解析")]),s._v(" "),n("ul",[n("li",[s._v("https://www.cnblogs.com/xiangsikai/p/8438772.html")])])])}),[],!1,null,null,null);n.default=e.exports}}]);