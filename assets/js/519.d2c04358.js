(window.webpackJsonp=window.webpackJsonp||[]).push([[519],{931:function(t,e,_){"use strict";_.r(e);var a=_(1),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"电商支付流程实战详解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#电商支付流程实战详解"}},[t._v("#")]),t._v(" "),e("strong",[t._v("电商支付流程实战详解")])]),t._v(" "),e("h1",{attrs:{id:"_1-阿里扫描支付演示全过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-阿里扫描支付演示全过程"}},[t._v("#")]),t._v(" 1.阿里扫描支付演示全过程")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626689-84b9cc42-bcc1-4c48-a395-e12b7cd092fd.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_22%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"_1-1-当面支付介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-当面支付介绍"}},[t._v("#")]),t._v(" 1.1 当面支付介绍")]),t._v(" "),e("p",[t._v("当面付帮助商家在线下消费场景下实现快速收款，支持 条码支付 和 扫码支付 两种付款方式。商家可通过以下任一方式进行收款，提升商家收银效率，资金实时到账。")]),t._v(" "),e("ul",[e("li",[t._v("商家通过扫描线下买家支付宝钱包中的条码、二维码等方式完成收款。")]),t._v(" "),e("li",[t._v("买家通过使用支付宝 “扫一扫” 功能，扫描商家的二维码等方式完成支付。")])]),t._v(" "),e("p",[t._v("​       文档地址： https://opensupport.alipay.com/support/helpcenter/85/201602490909")]),t._v(" "),e("p",[t._v("扫码支付的应用场景")]),t._v(" "),e("p",[t._v("用户打开支付宝中的 扫一扫 功能，扫描商家展示的二维码进行支付。该模式适用于线下实体店支付、面对面支付、自助售货机等场景。流程如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626698-86958b7f-00e5-4e46-b9fc-3de3480a9b02.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_55%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("p",[t._v("使用说明")]),t._v(" "),e("ol",[e("li",[t._v("收银员在商家收银系统操作生成支付宝订单，并生成二维码。")]),t._v(" "),e("li",[t._v("用户登录支付宝，点击首页 扫一扫 或点击 付钱-扫码付，进入扫码界面。")]),t._v(" "),e("li",[t._v("用户扫收银员提供的二维码，核对金额，确认支付。")]),t._v(" "),e("li",[t._v("用户付款支付宝提示成功或失败，商家收银系统会拿到支付成功或者失败的结果。")])]),t._v(" "),e("h2",{attrs:{id:"_1-2-扫码支付demo使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-扫码支付demo使用"}},[t._v("#")]),t._v(" 1.2  扫码支付Demo使用")]),t._v(" "),e("p",[t._v("下载Demo           https://opendocs.alipay.com/open/54/104506")]),t._v(" "),e("p",[t._v("扫码支付依赖包  https://mvnrepository.com/artifact/com.alipay.sdk/alipay-sdk-java")]),t._v(" "),e("p",[t._v("沙箱环境             https://opendocs.alipay.com/open/200/105311")]),t._v(" "),e("p",[t._v("生成公私钥工具  https://opendocs.alipay.com/open/291/introduce")]),t._v(" "),e("p",[t._v("公私钥设置 说明  https://opendocs.alipay.com/open/291/105971#LDsXr")]),t._v(" "),e("p",[t._v("沙箱app下载地址 https://openhome.alipay.com/platform/appDaily.htm")]),t._v(" "),e("p",[t._v("步骤：")]),t._v(" "),e("h3",{attrs:{id:"_1-2-1-下载扫码支付演示代码包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-下载扫码支付演示代码包"}},[t._v("#")]),t._v(" 1.2.1 下载扫码支付演示代码包")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626674-ccd6c060-7fde-4946-9f52-6abf79dcfd5c.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_44%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h3",{attrs:{id:"_1-2-2-引入扫码支付依赖包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-引入扫码支付依赖包"}},[t._v("#")]),t._v(" 1.2.2 引入扫码支付依赖包")]),t._v(" "),e("dependency",[e("p",[e("groupId",[t._v("com.alipay.sdk")])],1),t._v(" "),e("p",[e("artifactId",[t._v("alipay-sdk-java")])],1),t._v(" "),e("p",[e("version",[t._v("4.10.0.ALL")])],1)]),t._v(" "),e("h3",{attrs:{id:"_1-2-3-导入demo的代码文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-导入demo的代码文件"}},[t._v("#")]),t._v(" 1.2.3 导入demo的代码文件")]),t._v(" "),e("h3",{attrs:{id:"_1-2-4-修改-支付宝配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-修改-支付宝配置文件"}},[t._v("#")]),t._v(" 1.2.4 修改 支付宝配置文件")]),t._v(" "),e("p",[t._v("文件名 zfbinfo.properties")]),t._v(" "),e("p",[t._v("pid = 此处请填写你的PID")]),t._v(" "),e("p",[t._v("appid = 此处请填写你当面付的APPID")]),t._v(" "),e("p",[t._v("# RSA私钥、公钥和支付宝公钥")]),t._v(" "),e("p",[t._v("private_key = 此处请填写你的商户私钥且转PKCS8格式")]),t._v(" "),e("p",[t._v("public_key = 此处请填写你的商户公钥")]),t._v(" "),e("p",[t._v("#SHA1withRsa对应支付宝公钥")]),t._v(" "),e("p",[t._v("#alipay_public_key =")]),t._v(" "),e("p",[t._v("#SHA256withRsa对应支付宝公钥")]),t._v(" "),e("p",[t._v("alipay_public_key")]),t._v(" "),e("h3",{attrs:{id:"_1-2-5-appid-设置步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-appid-设置步骤"}},[t._v("#")]),t._v(" 1.2.5 appid 设置步骤")]),t._v(" "),e("p",[t._v("https://openhome.alipay.com/platform/appDaily.htm")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203627869-3bd92de3-8147-49f0-9d3c-0ac18b5064ea.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_49%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h3",{attrs:{id:"_1-2-6-pid-设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-6-pid-设置"}},[t._v("#")]),t._v(" 1.2.6 pid 设置")]),t._v(" "),e("p",[t._v("来源： 登入支付宝开发者中心 查看账户信息")]),t._v(" "),e("p",[t._v("https://openhome.alipay.com/dev/workspace/account-center/main-account-manage")]),t._v(" "),e("h3",{attrs:{id:"_1-2-7-公私钥生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-7-公私钥生成"}},[t._v("#")]),t._v(" 1.2.7 公私钥生成")]),t._v(" "),e("p",[t._v("打开支付宝开发平台助手工具 生成")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626713-ef4b7c5d-9782-45a8-97e3-eedd24b9dfd0.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_32%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h3",{attrs:{id:"_1-2-8-阿里支付公钥生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-8-阿里支付公钥生成"}},[t._v("#")]),t._v(" 1.2.8 阿里支付公钥生成")]),t._v(" "),e("p",[t._v("alipay_public_key 来源：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626724-c17973ee-3f41-4844-8f27-51db75c83d13.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_43%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626679-45451a46-fdb3-478c-b67f-ba26b1875029.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_40%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626715-b17d6909-c1b2-455c-852a-ed250e28c571.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_25%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"_1-3-下载沙箱支付宝app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-下载沙箱支付宝app"}},[t._v("#")]),t._v(" 1.3 下载沙箱支付宝app")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626670-fcfef008-6da0-4f55-b7c1-d309ed81bd20.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_41%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("p",[t._v("安装完成后使用沙箱账号登入")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626715-07617b5c-7767-46e9-a50d-96b644824455.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_18%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h1",{attrs:{id:"_1-4-整合电商下单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-整合电商下单"}},[t._v("#")]),t._v(" 1.4 整合电商下单")]),t._v(" "),e("h2",{attrs:{id:"_1-4-1-新建module"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-新建module"}},[t._v("#")]),t._v(" 1.4.1 新建module")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203627641-c4af229e-f2e6-476e-9baa-2dbf29754d44.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_35%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"_1-4-2-引入maven依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-引入maven依赖"}},[t._v("#")]),t._v(" 1.4.2 引入maven依赖")]),t._v(" "),e("h2",{attrs:{id:"_1-4-3-导入demo包java文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-3-导入demo包java文件"}},[t._v("#")]),t._v(" 1.4.3 导入Demo包Java文件")]),t._v(" "),e("p",[t._v("将TradePaySDK包下文件拷贝到工程下")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626722-60b62e89-a926-429a-bcf0-c7cd893d5074.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_17%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("p",[t._v("将F2FPay_Demo_Java工程两个Java文件和配置文件拷贝到工程下")]),t._v(" "),e("p",[t._v("DemoHbRunner.java")]),t._v(" "),e("p",[t._v("Main.java")]),t._v(" "),e("p",[t._v("zfbinfo.properties")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626765-6ad963a8-f046-47da-9d23-3d75586195a4.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_19%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"_1-4-4-修改配置文件zfbinfo-properties"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-4-修改配置文件zfbinfo-properties"}},[t._v("#")]),t._v(" 1.4.4 修改配置文件zfbinfo.properties")]),t._v(" "),e("p",[t._v("open_api_domain = https://openapi.alipay.com/gateway.do")]),t._v(" "),e("p",[t._v("mcloud_api_domain = http://mcloudmonitor.com/gateway.do")]),t._v(" "),e("p",[t._v("pid = 此处请填写你的PID")]),t._v(" "),e("p",[t._v("appid = 此处请填写你当面付的APPID")]),t._v(" "),e("p",[t._v("# RSA私钥、公钥和支付宝公钥")]),t._v(" "),e("p",[t._v("private_key = 此处请填写你的商户私钥且转PKCS8格式")]),t._v(" "),e("p",[t._v("public_key = 此处请填写你的商户公钥")]),t._v(" "),e("p",[t._v("#SHA1withRsa对应支付宝公钥")]),t._v(" "),e("p",[t._v("#alipay_public_key = MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOaTXyiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632rwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDAQAB")]),t._v(" "),e("p",[t._v("#SHA256withRsa对应支付宝公钥")]),t._v(" "),e("p",[t._v("alipay_public_key = MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjrEVFMOSiNJXaRNKicQuQdsREraftDA9Tua3WNZwcpeXeh8Wrt+V9JilLqSa7N7sVqwp6hEg97Oxe6GKUmzaZRNh0cZZ88vpkn5tlgL4mH/dhSr3Ip00kvM4rHq9PwuT4k7z1DpZAf1eghK8Q5BgxL88d0X07m9X96Ijd0yMkXArzD7jg+noqfbztEKoH3kPMRJC2w4ByVdweWUT2PwrlATpZZtYLmtDvUKG/sOkNAIKEMg3Rut1oKWpjyYanzDgS7Cg3awr1KPTl9rHCazk15aNYowmYtVabKwbGVToCAGK+qQ1gT3ELhkGnf3+h53fukNqRH+wIDAQ")]),t._v(" "),e("h2",{attrs:{id:"_1-4-5-创建支付下单服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-5-创建支付下单服务"}},[t._v("#")]),t._v(" 1.4.5 创建支付下单服务")]),t._v(" "),e("p",[t._v("类名 com.order.service.impl.PayServiceImpl")]),t._v(" "),e("p",[t._v("public String genQrCode(OrderDetail orderDetail) {")]),t._v(" "),e("p",[t._v("//支付二维码的访问路径")]),t._v(" "),e("p",[t._v("String qrCodePath = null;")]),t._v(" "),e("p",[t._v("// (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线，")]),t._v(" "),e("p",[t._v("// 需保证商户系统端不能重复，建议通过数据库sequence生成，")]),t._v(" "),e("p",[t._v('String outTradeNo = "tradepay" + System.currentTimeMillis()')]),t._v(" "),e("p",[t._v("​      + (long) (Math.random() * 10000000L);")]),t._v(" "),e("p",[t._v("// (必填) 订单标题，粗略描述用户的支付目的。如“xxx品牌xxx门店消费”")]),t._v(" "),e("p",[t._v('String subject = "xxx品牌xxx门店当面付消费";')]),t._v(" "),e("p",[t._v("// (必填) 订单总金额，单位为元，不能超过1亿元")]),t._v(" "),e("p",[t._v("// 如果同时传入了【打折金额】,【不可打折金额】,【订单总金额】三者,则必须满足如下条件:【订单总金额】=【打折金额】+【不可打折金额】")]),t._v(" "),e("p",[t._v("String totalAmount = orderDetail.getPayAmount().toString();")]),t._v(" "),e("p",[t._v("// (必填) 付款条码，用户支付宝钱包手机app点击“付款”产生的付款条码")]),t._v(" "),e("p",[t._v('String authCode = "用户自己的支付宝付款码"; // 条码示例，286648048691290423')]),t._v(" "),e("p",[t._v("// (可选，根据需要决定是否使用) 订单可打折金额，可以配合商家平台配置折扣活动，如果订单部分商品参与打折，可以将部分商品总价填写至此字段，默认全部商品可打折")]),t._v(" "),e("p",[t._v("// 如果该值未传入,但传入了【订单总金额】,【不可打折金额】 则该值默认为【订单总金额】- 【不可打折金额】")]),t._v(" "),e("p",[t._v('//     String discountableAmount = "1.00"; //')]),t._v(" "),e("p",[t._v("// (可选) 订单不可打折金额，可以配合商家平台配置折扣活动，如果酒水不参与打折，则将对应金额填写至此字段")]),t._v(" "),e("p",[t._v("// 如果该值未传入,但传入了【订单总金额】,【打折金额】,则该值默认为【订单总金额】-【打折金额】")]),t._v(" "),e("p",[t._v('String undiscountableAmount = "0.0";')]),t._v(" "),e("p",[t._v("// 卖家支付宝账号ID，用于支持一个签约账号下支持打款到不同的收款账号，(打款到sellerId对应的支付宝账号)")]),t._v(" "),e("p",[t._v("// 如果该字段为空，则默认为与支付宝签约的商户的PID，也就是appid对应的PID")]),t._v(" "),e("p",[t._v('String sellerId = "";')]),t._v(" "),e("p",[t._v('// 订单描述，可以对交易或商品进行一个详细地描述，比如填写"购买商品3件共20.00元"')]),t._v(" "),e("p",[t._v('String body = String.format("购买商品%s件共%s元",orderDetail.getItemList().size(),orderDetail.getPayAmount());')]),t._v(" "),e("p",[t._v("// 商户操作员编号，添加此参数可以为商户操作员做销售统计")]),t._v(" "),e("p",[t._v('String operatorId = "bole";')]),t._v(" "),e("p",[t._v("// (必填) 商户门店编号，通过门店号和商家后台可以配置精准到门店的折扣信息，详询支付宝技术支持")]),t._v(" "),e("p",[t._v('String storeId = "bole_store_id";')]),t._v(" "),e("p",[t._v("// 业务扩展参数，目前可添加由支付宝分配的系统商编号(通过setSysServiceProviderId方法)，详情请咨询支付宝技术支持")]),t._v(" "),e("p",[t._v('String providerId = "2088100200300400500";')]),t._v(" "),e("p",[t._v("ExtendParams extendParams = new ExtendParams();")]),t._v(" "),e("p",[t._v("extendParams.setSysServiceProviderId(providerId);")]),t._v(" "),e("p",[t._v("// 支付超时，线下扫码交易定义为5分钟")]),t._v(" "),e("p",[t._v('String timeoutExpress = "5m";')]),t._v(" "),e("p",[t._v("// 商品明细列表，需填写购买商品详细信息，")]),t._v(" "),e("p",[t._v("List"),e("GoodsDetail",[t._v(" goodsDetailList = new ArrayList"),e("GoodsDetail",[t._v("();")])],1)],1),t._v(" "),e("p",[t._v("// 创建一个商品信息，参数含义分别为商品id（使用国标）、名称、单价（单位为分）、数量，如果需要添加商品类别，详见GoodsDetail")]),t._v(" "),e("p",[t._v('//GoodsDetail goods1 = GoodsDetail.newInstance("goods_id001", "xxx面包", 1000, 1);')]),t._v(" "),e("p",[t._v("// 创建好一个商品后添加至商品明细列表")]),t._v(" "),e("p",[t._v("//goodsDetailList.add(goods1);")]),t._v(" "),e("p",[t._v("// 继续创建并添加第一条商品信息，用户购买的产品为“黑人牙刷”，单价为5.00元，购买了两件")]),t._v(" "),e("p",[t._v('//  GoodsDetail goods2 = GoodsDetail.newInstance("goods_id002", "xxx牙刷", 500, 2);')]),t._v(" "),e("p",[t._v("//  goodsDetailList.add(goods2);")]),t._v(" "),e("p",[t._v("if(orderDetail!=null){")]),t._v(" "),e("p",[t._v("​    orderDetail.getItemList().forEach(o->{")]),t._v(" "),e("p",[t._v("​      GoodsDetail good = GoodsDetail.newInstance(o.getOrderSn(),o.getProductName(),o.getProductPrice().multiply(new BigDecimal(100)).longValue(),o.getProductQuantity());")]),t._v(" "),e("p",[t._v("​      goodsDetailList.add(good);")]),t._v(" "),e("p",[t._v("​    });")]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("p",[t._v('String appAuthToken = "应用授权令牌";//根据真实值填写')]),t._v(" "),e("p",[t._v("// 创建条码支付请求builder，设置请求参数")]),t._v(" "),e("p",[t._v("AlipayTradePrecreateRequestBuilder builder = new AlipayTradePrecreateRequestBuilder()")]),t._v(" "),e("p",[t._v("​      .setSubject(subject).setTotalAmount(totalAmount).setOutTradeNo(outTradeNo)")]),t._v(" "),e("p",[t._v("​      .setUndiscountableAmount(undiscountableAmount).setSellerId(sellerId).setBody(body)")]),t._v(" "),e("p",[t._v("​      .setOperatorId(operatorId).setStoreId(storeId).setExtendParams(extendParams)")]),t._v(" "),e("p",[t._v("​      .setTimeoutExpress(timeoutExpress)")]),t._v(" "),e("p",[t._v('​      //         .setNotifyUrl("http://www.test-notify-url.com")//支付宝服务器主动通知商户服务器里指定的页面http路径,根据需要设置')]),t._v(" "),e("p",[t._v("​      .setGoodsDetailList(goodsDetailList);")]),t._v(" "),e("p",[t._v("// 调用tradePay方法获取当面付应答")]),t._v(" "),e("p",[t._v("AlipayF2FPrecreateResult result = tradeService.tradePrecreate(builder);")]),t._v(" "),e("p",[t._v("switch (result.getTradeStatus()) {")]),t._v(" "),e("p",[t._v("​    case SUCCESS:")]),t._v(" "),e("p",[t._v('​      log.info("支付宝支付成功!");')]),t._v(" "),e("p",[t._v("​      AlipayTradePrecreateResponse response= result.getResponse();")]),t._v(" "),e("p",[t._v("​      print(response);")]),t._v(" "),e("p",[t._v('​      String qrPath=String.format(payConfig.getAlipayPath()+"/qr-%s.png",response.getOutTradeNo());')]),t._v(" "),e("p",[t._v("​      String fullQrPath=payConfig.getQrBasePath()+qrPath;")]),t._v(" "),e("p",[t._v('​      log.info("本地二维码生成："+fullQrPath);')]),t._v(" "),e("p",[t._v("​      ZxingUtils.getQRCodeImge(response.getQrCode(), 256, fullQrPath);")]),t._v(" "),e("p",[t._v("​      qrCodePath=payConfig.getHttpResourcePath()+qrPath;")]),t._v(" "),e("p",[t._v("​      break;")]),t._v(" "),e("p",[t._v("​    case FAILED:")]),t._v(" "),e("p",[t._v('​      log.error("支付宝支付失败!!!");')]),t._v(" "),e("p",[t._v("​      break;")]),t._v(" "),e("p",[t._v("​    case UNKNOWN:")]),t._v(" "),e("p",[t._v('​      log.error("系统异常，订单状态未知!!!");')]),t._v(" "),e("p",[t._v("​      break;")]),t._v(" "),e("p",[t._v("​    default:")]),t._v(" "),e("p",[t._v('​      log.error("不支持的交易状态，交易返回异常!!!");')]),t._v(" "),e("p",[t._v("​      break;")]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("h2",{attrs:{id:"_1-4-6-映射二维码本地路径到网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-6-映射二维码本地路径到网络"}},[t._v("#")]),t._v(" 1.4.6 映射二维码本地路径到网络")]),t._v(" "),e("p",[t._v("@Override")]),t._v(" "),e("p",[t._v("public void addResourceHandlers(ResourceHandlerRegistry registry) {")]),t._v(" "),e("p",[t._v('String os = System.getProperty("os.name");')]),t._v(" "),e("p",[t._v('if(os.toLowerCase().startsWith("win")){ //windows系统')]),t._v(" "),e("p",[t._v("​    /** 支付码图片QrCode图片存储路径 */")]),t._v(" "),e("p",[t._v("​    registry.addResourceHandler(payConfig.getHttpResourcePath()")]),t._v(" "),e("p",[t._v('​        +"/**")')]),t._v(" "),e("p",[t._v('​        .addResourceLocations("file:" + payConfig.getQrBasePath() + "/");')]),t._v(" "),e("p",[t._v("}else{ //linux或者mac")]),t._v(" "),e("p",[t._v('​    registry.addResourceHandler("/static/resources/**")')]),t._v(" "),e("p",[t._v('​        .addResourceLocations("file:/usr/local/resources/"); //静态资源')]),t._v(" "),e("p",[t._v('​        //.addResourceLocations("classpath:/META-INF/resources/"); //swagger2页面')]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("h2",{attrs:{id:"_1-4-7-创建下单controller"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-7-创建下单controller"}},[t._v("#")]),t._v(" 1.4.7 创建下单Controller")]),t._v(" "),e("p",[t._v('@PostMapping("/genQrCode")')]),t._v(" "),e("p",[t._v("public CommonResult genQrCode(@RequestBody OrderDetail orderDetail) throws BusinessException {")]),t._v(" "),e("p",[t._v("String path = payService.genQrCode(orderDetail);")]),t._v(" "),e("p",[t._v("if(StringUtils.isNotEmpty(path)){")]),t._v(" "),e("p",[t._v("​    return  CommonResult.success(path);")]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("p",[t._v("return CommonResult.failed();")]),t._v(" "),e("p",[t._v("}")]),t._v(" "),e("h1",{attrs:{id:"_1-5-测试下单生成二维码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-测试下单生成二维码"}},[t._v("#")]),t._v(" 1.5 测试下单生成二维码")]),t._v(" "),e("h2",{attrs:{id:"_1-5-1-发起下单支付请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-发起下单支付请求"}},[t._v("#")]),t._v(" 1.5.1 发起下单支付请求")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626709-474b03e3-8796-4ad3-a74f-cca8d08fbc12.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_33%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"_1-5-2-返回支付二维码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-返回支付二维码"}},[t._v("#")]),t._v(" 1.5.2 返回支付二维码")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/1300531/1594203626708-5ead459b-2290-4fdf-905d-ebc86ed291cf.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_38%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})])],1)}),[],!1,null,null,null);e.default=r.exports}}]);